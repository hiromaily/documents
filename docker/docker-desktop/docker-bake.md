# Docker Bake

Docker Desktop 4.38で一般提供が開始された強力な`ビルドオーケストレーションツール`。このツールは、複雑なDockerビルドプロセスを簡素化し、効率化することを目的としている。

## 主な特徴

1. **シンプルさ**: 複雑なDockerビルドコマンドとスクリプトを単一の`docker buildx bake`コマンドに置き換えることができる。

2. **柔軟性**: HCL構文とマトリックスビルドを通じて高度なビルドロジックを表現し、さまざまな環境や要件に適応する動的構成が可能。

3. **一貫性**: バージョン管理されたファイルと継承パターンを通じて、チームと環境間で標準化されたビルド構成を維持できる。

4. **パフォーマンス**: 独立したビルドを自動的に並列化し、コンテキスト重複排除とインテリジェントキャッシングにより冗長な操作を排除する。

## 主な機能

- **ターゲットとグループ**: ビルド設定を論理的にグループ化できる。
- **変数**: 動的な値を設定に組み込むことができる。
- **HCL式サポート**: より柔軟な設定が可能。
- **継承**: 設定の再利用と拡張が容易になる。
- **マトリックスターゲット**: 複数の設定バリエーションを効率的に定義できる。

## 新機能（GA版）

1. **重複排除されたコンテキスト転送**: 複数のターゲットが同じビルドコンテキストを共有する場合の冗長なファイル転送を排除する。

2. **エンタイトルメント**: ビルドプロセス中にビルダーがアクセスできる機能とリソースをきめ細かく制御できる。

3. **コンポーザブル属性**: 再利用可能な属性セットを定義し、異なるターゲット間で組み合わせたり、オーバーライドしたりできる。

4. **変数の検証**: 設定エラーを早期に検出し、時間とリソースの無駄を防ぐ。

## 使用例

Docker Bakeは、モノレポやイメージベーカリーのシナリオで特に有用です。1つのソースリポジトリから複数の関連するDockerイメージを効率的に管理および構築できる。

## 使用方法

Docker Bakeの設定は、`HCL`または`docker-compose.yml`ファイルで記述できる。以下は基本的な使用例：

```hcl
variable "TAG" {
  default = "latest"
}

group "default" {
  targets = ["webapp"]
}

target "webapp" {
  tags = ["docker.io/username/webapp:${TAG}"]
}
```

このような設定を使用して、`docker buildx bake`コマンドでビルドを実行できる。

## References

- [ビルド自動化ツールの「Docker Bake」がDocker Desktop 4.38で一般提供開始]
