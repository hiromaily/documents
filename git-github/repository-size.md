# Gitのリポジトリをコンパクトにする

[参考: 【Git】リポジトリをコンパクトにする](https://programmingforever.hatenablog.com/entry/2021/09/20/212733)

## リポジトリのディスク容量を削減する

開発を何年も継続していると、リポジトリも大きくなる。サイズ削減には以下の方法がある。

| 方法           | 過去へのアクセス | 削減度 | 作業の手軽さ |
| -------------- | ---------------- | ------ | ------------ |
| git-gc         | ◎                | 50%～  | ◎            |
| partial-clone  | ◎                | 90%～  | ◯            |
| shallow-clone  | ◯                | 90%～  | ◯            |
| logic-compress | ◯                | 90%～  | △            |
| reborn         | ✕                | 100%   | ◯            |

### その１：git gcを用いる

最も簡単で効果的な手段。通常、Gitはファイルをスナップショットして全て保存するが、`git gc`を実行するとバイナリファイルに差分保存することでディスク容量を圧縮します。オプションを付けることでさらに圧縮率を上げることが可能。

### その２：クローンサイズを下げる：パーシャルクローン

Gitのリポジトリが大きくなると、多くのcommit、tree、blob（ファイル）オブジェクトを保持する。過去の特定commitに戻る機能を維持するためだが、必要なデータのみを保持する「パーシャルクローン」機能がある。

- **フルクローン**: 全てのcommit、tree、blobを保持
- **プロブレスクローン**: 全commit、全tree、最新blobのみ保持
- **ツリーレスクローン**: 全commit、最新treeのみ、最新blobのみ保持
- **シャロークローン**: 最新commitのみ、最新treeのみ、最新blobのみ保持

#### コマンド例

- **フルクローン**: 

   ```bash
   git clone
   ```

- **パーシャルクローン（ブロブレスクローン）**: 

   ```bash
   git clone --filter=blob:none
   ```

- **パーシャルクローン（ツリーレスクローン）**: 

   ```bash
   git clone --filter=tree:0
   ```

### その３：クローンサイズを下げる：シャロークローン

過去のcommitにはアクセスせず、最新ファイルだけのビルドを行う場合に適している。

```bash
git clone --depth=1
```

### その４：不要なブランチやblobを整理してgcで高圧縮

リポジトリの論理的に不要な部分を削除する方法。

### その５：ゼロから新しいリポジトリを生成

シャロークローンを使用して、最新ファイルを元に新しいリポジトリを立ち上げることがでる。この方法で作成したリポジトリは元のリポジトリとは完全に縁が切れた別物になる。

> **注意**: この方法で作成した新生リポジトリは元のリポジトリと完全に縁が切れる。
