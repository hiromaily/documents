# コンパイラ

コンパイラは、プログラムのソースコードを他の形式に変換するツールで、具体的には高水準プログラミング言語（例: C++、Java、Python）を低水準の機械語（バイナリコード）や中間コードに変換するために使用される。

コンパイラは複雑なツールだが、プログラムを効率的かつ安全に実行するために不可欠な役割を果たしている。

## コンパイラの基本的な概念

1. **ソースコード**: 開発者が書く高水準言語のコード。
2. **機械語**: CPUが実行できる低水準のバイナリコード。
3. **中間コード**: より処理しやすい形態に変換したコード（例: JavaバイトコードやLLVM IR）で、さらに最適化や解析を行える。

## コンパイラのフェーズ

コンパイラは通常、以下のような複数のフェーズで動作する。

1. **字句解析（Lexical Analysis）**:
    - ソースコードをシンボル（トークン）に分割。
    - トークンはキーワード、識別子、リテラル、演算子など。
    - 例: ソースコード `int x = 10;` はトークン `int`, `x`, `=`, `10`, `;` に分割される。

2. **構文解析（Syntax Analysis）**:
    - トークンの列を構文木（パースツリー）に変換する。
    - 構文木はプログラムの文法構造を表す。
    - 例: `int x = 10;` はノード `=`, 子ノード `int x`, `10` のような形で表現される。

3. **意味解析（Semantic Analysis）**:
    - 構文木に意味情報を付加し、型チェックやスコープの解析を行う。
    - 例: 変数 `x` が適切に初期化され、使用されているかを確認する。

4. **中間コード生成（Intermediate Code Generation）**:
    - プログラムを中間コードに変換する。これは最適化やコード生成の入力として用いられる。

5. **最適化（Optimization）**:
    - 中間コードを最適化して、実行効率を向上させる。
    - 例: キャッシュを考慮したループの最適化など。

6. **コード生成（Code Generation）**:
    - 最適化された中間コードを機械語に変換する。
    - 例: x86アーキテクチャ用のアセンブリコードを生成する。

7. **コード最適化（Code Optimization）**:
    - 最終生成された機械語をさらに最適化する。
    - 例: 不要な命令の削除やレジスタ割り当ての改善など。

## 代表的なコンパイラ

- **GCC (GNU Compiler Collection)**:
  - C、C++、Objective-C、Fortran、Ada などをサポートする多言語コンパイラ。
  - クロスプラットフォームで広く使用されている。

- **Clang**:
  - LLVMベースのC、C++、Objective-Cコンパイラ。
  - 高い解析能力と迅速なコンパイル性能が特徴。

- **Javac**:
  - Javaコンパイラ。
  - ソースコードをバイトコードに変換し、JVM（Java Virtual Machine）で実行する。

- **Rustc**:
  - Rustプログラミング言語の公式コンパイラ。
  - LLVMをバックエンドに持ち、高速なコンパイルと安全性を特徴とする。

## コンパイラ まとめ

コンパイラとは、ある言語（プログラミング言語）で書かれたプログラム（ソースプログラム）を読み、それを別の言語で書かれた等価のプログラム（ターゲットプログラム）へと翻訳（translate）するプログラム

### コンパイル戦略

- [実行時コンパイラ: JIT コンパイラ](https://ja.wikipedia.org/wiki/%E5%AE%9F%E8%A1%8C%E6%99%82%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%A9)
- [事前コンパイラ: AOT コンパイラ](https://ja.wikipedia.org/wiki/%E4%BA%8B%E5%89%8D%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%A9)
- [トランスコンパイラ](https://ja.wikipedia.org/wiki/%E3%83%88%E3%83%A9%E3%83%B3%E3%82%B9%E3%82%B3%E3%83%B3%E3%83%91%E3%82%A4%E3%83%A9)

### インタプリタ/interpreter (比較のため)

プログラミング言語で書かれたソースコードないし中間表現を逐次解釈しながら実行するプログラムのこと

## References

- [Interpreted vs Compiled Programming Languages](https://www.freecodecamp.org/news/compiled-versus-interpreted-languages/)
- [2020: Go コンパイラのコードを読んでみよう](https://kosui.me/posts/2020/12/golang-compiler/)
