# Security for Password

- パスワードのハッシュ化は一般的だが、意味がなくなりつつある状況にある。

## パスワードの豆知識

参考: [「パスワードを紙に書く管理方法は意外と安全」「パスワードの定期的な変更は危険」「記号や数字の混在を義務付けるのはNG」など知っておくべきパスワード知識](https://gigazine.net/news/20240927-password-security/)

- パスワードの定期的な変更は危険
- パスワードは紙に書く管理方法は意外と安全
- 記号や数字の混在を義務付けるのはNG
- パスワードは長い方がいい
- 「パスワードのヒント」は実装してはならない
- 「秘密の質問」は実装してはならない

## ハッシュ値から元のパスワードを割り出す手法

- `レインボーテーブル`が一般的
  - 元の文字列とhash化された文字列の情報を持っておき、ハッシュ値から元の文字列を割り出すことができる。
  - つまり、元の文字列が同じであればハッシュ値も同じなので、よく使われる単純なパスワードが特に危険になる
- `総当り攻撃（ブルートフォース攻撃）`
  - 現在では、GPUの性能が非常に高くなっていて、秒間で何千億回の計算が可能
  - 桁数が増えるごとに、計算量は飛躍的に増える。そのため、長いパスワード長が推奨される

| 使用する文字の種類                 | 使用可能文字数 | 4桁        | 6桁             | 8桁                   | 10桁                           |
| ---------------------------------- | -------------- | ---------- | --------------- | --------------------- | ------------------------------ |
| 数字（0～9）                       | 10             | 10,000     | 1,000,000       | 100,000,000           | 10,000,000,000                 |
| 英字（小文字a～zのみ）             | 26             | 456,976    | 308,915,776     | 208,827,064,576       | 141,167,095,653,376            |
| 英字（小文字a～zのみ）＋数字       | 36             | 1,679,616  | 2,176,782,336   | 2,821,109,907,456     | 3,656,158,440,062,980          |
| 英字（大小あり）＋数字             | 62             | 14,776,336 | 56,800,235,584  | 218,340,105,584,896   | 839,299,365,868,340,000        |
| 英字（大小あり）＋数字＋記号31文字 | 93             | 74,805,201 | 646,990,183,449 | 5,595,818,096,650,400 | 48,398,230,717,929,300,000     |
| 英字（大小あり）＋数字＋記号32文字 | 94             | 78,074,896 | 689,869,781,056 | 6,095,689,385,410,820 | 53,861,511,409,490,000,000,000 |
| 英字（大小あり）＋数字＋記号34文字 | 96             | 84,934,656 | 782,757,789,696 | 7,213,895,789,838,340 | 66,483,263,599,150,100,000,000 |

## ハッシュアルゴリズムの選択

[参考: 暗号技術/一方向ハッシュ関数](../cryptography/one-way-hash.md)

### 非推奨

- MD5
- SHA-1

### 推奨

- SHA-2 (SHA-256, SHA-384, SHA-512)
- SHA-3 (KECCAK)

## SaltとPepper、Stretching

- SaltやPepperは、パスワード解析をできるだけ遅くし被害を低減するという考えに基づいている

### Saltを利用する

- 元の文字列に`Salt`と呼ばれる文字列を追加した上でハッシュ化する手法
- Salt付きのハッシュ値から割り出しを行っても、割り出された文字列は元の文字列＋Saltの文字列になるため、ここから元の文字列を割り出すには、さらに一手間必要となる
- 同一のsaltを利用すると、同一パスワードは同じハッシュ値になるため、割り出しやすくなってしまう
- そのため、ユーザーごとに`Salt`を用意したほうがよい

### Pepper

- SaltをPasswordと同じようにDatabaseに保存した場合、Saltまで流出する可能性がある
- Pepperは`Secret Salt`とも言われ、ハッシュ値やSaltと別の場所に保存するが、一般的には、`HSM`(Hierarchical Storage Management)などの機密性を高めたストレージに保存することになる
- Pepperは、ユーザー毎ではなく共通のケースが多い

![store password](../images/pass-db-hash.png 'store password')

### Stretching

- 何度も繰り返しハッシュ化し元のデータの推測を困難にする手法で、攻撃者側の計算量を増やす緩和策として利用される

## サイトをまたがった同一ID/パスワードの使いまわしへの対策

- `二要素認証`: IDとパスワード以外に、SMSやワンタイムパスワードなど、もう一つの認証要素を加える方法
- `IDaaS`: 認証サービスで、ログインを試みた側の総合的な情報をもとに怪しい振る舞いを検知して遮断するといった高度な防御策

## References
