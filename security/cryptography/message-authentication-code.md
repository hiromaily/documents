# メッセージ認証コード / Message Authentication Code / MAC

WIP

Message Authentication Code（MAC）は、メッセージの認証と完全性を確認するための技術。MAC は、メッセージが改ざんされていないことと、メッセージが確かに送信者から来たものであることを保証する。対称鍵暗号の技術を使い、メッセージと鍵を基に固定長の認証タグを生成する。この認証タグを用いることで、受信者はメッセージが改ざんされていないか、また送信者が信頼できるかを確認することができる。HMAC や CMAC などの様々なアルゴリズムがあり、それぞれの用途や要件に応じて適応する。セキュリティの確保には鍵管理が重要な課題となるが、適切な運用を行うことで高い信頼性を提供する。

## 基本概念

1. **メッセージ認証および完全性**: MAC は、メッセージが改ざんされていないこと（完全性）と、認証済みの送信者から送られたものであること（認証）を確認するために使用される。
2. **対称鍵**: MAC には対称鍵が使われる。送信者と受信者が同じ秘密鍵を共有していること前提に動作する。

## 主要な要素

1. **メッセージ（M）**: 認証され、完全性が確認されるメッセージ。
2. **秘密鍵（K）**: 共通鍵とも呼ばれ、メッセージの認証タグを生成および確認するために使用される鍵。
3. **MAC 関数（MAC(K, M)）**: 入力メッセージと鍵を元に、固定長の認証コード（タグ）を生成する関数。この認証コードを MAC タグと呼ぶ。

## 動作原理

1. **送信側**:

   - 送信者はメッセージ（M）と秘密鍵（K）を使って MAC タグ（T = MAC(K, M)）を生成する。
   - メッセージと MAC タグを受信者に送信する。

2. **受信側**:
   - 受信者は、受け取ったメッセージと MAC タグ、および共有した秘密鍵を使って MAC タグを再生成する（T' = MAC(K, M)）。
   - 受け取った MAC タグと再生成した MAC タグを比較する。一致すればメッセージの完全性と認証が確認できる。一致しない場合、メッセージは改ざんされた可能性がある。

## 代表的な MAC アルゴリズム

1. **HMAC (Hash-based Message Authentication Code)**:

   - 任意の暗号学的ハッシュ関数（例: SHA-256）を使用して MAC を生成する。
   - HMAC は広く使われている。特に TLS、IPsec、HTTPS などのプロトコルで標準化されている。

2. **CMAC (Cipher-based Message Authentication Code)**:

   - ブロック暗号（例: AES）を使用して MAC を生成する。
   - 特に AES をベースにした場合、AES-CMAC として標準化されている。

3. **OMAC (One-Key MAC)**:

   - 鍵 1 つで動作する CMAC の変種。
   - 特定の条件下で効率的に使用するために設計されている。

4. **Poly1305**:
   - 高速な MAC アルゴリズムであり、特に軽量でリソースが限られた環境で使用される。
   - ChaCha20-Poly1305 のように、暗号アルゴリズムと組み合わせて使われることが多い。

## MAC の利点と課題

**利点**:

1. **簡易性**: 簡単に実装でき、計算コストも低め。
2. **信頼性**: 対称鍵暗号化の技術を応用しているため、堅牢なセキュリティを提供する。

**課題**:

1. **鍵管理**: 対称鍵を安全に管理・交換する必要がある。
2. **スケーラビリティ**: 多数のユーザーと鍵を共有する必要があるシステムでは、鍵管理が複雑になる可能性がある

## 適用例

1. **ネットワークプロトコル**: TLS、IPsec など、セキュアな通信プロトコルでデータの完全性と認証を保証するために使用される。
2. **ストレージの保護**: データベースやファイルシステムで、データの改ざんを検知するために使われる。
3. **API セキュリティ**: Web サービスの API 認証に利用され、リクエストデータの改ざんを防ぐ。

## まとめ

- メッセージが`改ざん`されていないか、また誰かが送信者に`なりすまし`していないかどうかをチェックすることができる
- これには、`正真性`と`認証`の二つの性質が必要
  - メッセージの`正真性`とは、`メッセージが書き換えられていない(改ざんされていない)`という性質
  - メッセージの`認証 (authentication)`とは、`メッセージが正しい送信者からのものである`という性質
- つまりメッセージ認証コードとは、正真性を確認しメッセージの認証を行う技術
- `Message Authentication Code` で `MAC` と呼ばれる
