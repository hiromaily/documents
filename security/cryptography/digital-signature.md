# デジタル署名 / digital signature

- デジタルデータの１つであるメールを例に、 例えば`アリスがメールをボブに送る`とすると、危険性は以下の通り
  - 誰かがアリスに`なりすまし(spoofing)`をしている危険性がある
  - さらに、その内容は`改竄されている`危険性もある
  - 他にも、アリスがそんなメールは送信していないと`否認(repudiation)`する可能性もある
- 上記の`なりすまし`、`改竄`、`否認`を防ぐ技術が`デジタル署名`
- 上記の例では、アリスが文書に`デジタル署名`を施してからメールを送る。ボブはデジタル署名を`検証(verify)`する

## メッセージ認証コードの限界

- `メッセージ認証コード`で、`改竄`や`なりすまし`を検出することができるが、`否認`防止のためには使えない
- `メッセージ認証コード`を使うためには、送信者と受信者の 2 人が鍵を共有する必要があるのだが、`メッセージ認証コード`を使って正しい MAC 値を計算できるのは送信者だけではなく受信者もできる
- そのため、このメッセージはボブが作成したものということを第三者に証明することができない

## デジタル署名による解決のイメージ

- 前提として、送信者と受信者が鍵を共有する必要はない。つまり双方で別の鍵を使うことになる
- アリスが使う鍵はアリスだけが知っているアリスの`秘密鍵`とし、アリスがメッセージ送信時に、秘密鍵を使って`署名`を作成する
- 受信者ボブはアリスとは別の鍵を使って`署名`を`検証`する

## デジタル署名(署名)の実態

- メッセージごとに計算によって作り出す`自分でなければ計算できない数値`
- デジタル署名はメッセージごとに異なる値となる

## 署名の作成と署名の検証

- デジタル署名に伴う２つのアクション
  1. メッセージの署名を作成する
  2. メッセージの署名を検証する
- これら 2 つの行為には、それぞれ専用の鍵を使用することになる
- メッセージの署名を作成する:
  - これはアリスが行うもので、署名用の鍵を使ってメッセージを元にデジタル署名の値を計算する
- メッセージの署名を検証する:
  - これはボブが行うものだが、メッセージの検証を請け負う第三者が行う場合もある。ここでは検証者`ヴィクター`とする
  - 検証用の鍵を使って、このメッセージの署名は確かにアリスのものか調べる行為
- デジタル署名では、署名用の鍵と検証用の鍵が分かれており、検証用の鍵で署名をすることはできない。
- そして署名用の鍵は署名する人だけが持っているが、検証用の鍵は署名を検証する人なら誰でも持っている
- つまり、`公開鍵暗号`がこのような性質を持っている。
  - 公開鍵暗号では、`暗号化の鍵`と`復号化の鍵`が分かれており、復号化の鍵は復号化を行う人だけがもっており、暗号化の鍵は暗号化を行う人なら誰でも持っている
- デジタル署名は、`公開鍵暗号を逆に使う`ことで実現できる

|              | 秘密鍵                   | 公開鍵                       |
| ------------ | ------------------------ | ---------------------------- |
| 公開鍵暗号   | 受信者が復号化に使う     | 送信者たちが暗号化に使う     |
| デジタル署名 | 署名者が署名の作成に使う | 検証者たちが署名の検証に使う |
| 鍵の保持者   | 個人が持つ               | 必要な人は誰でも可能         |

## 公開鍵暗号とデジタル署名

- メッセージを`秘密鍵で暗号化する`ことが、`署名の作成`に相当する
- その暗号文を`公開鍵で復号化する`ことが`署名の検証`に相当する

#### 公開鍵による暗号化 (公開鍵暗号)

<img src="https://raw.githubusercontent.com/hiromaily/documents/main/images/publickey-cryptography.jpg"  width="50%" height="50%">

#### プライベート鍵による暗号化 (デジタル署名)

<img src="https://raw.githubusercontent.com/hiromaily/documents/main/images/degital-signature.jpg"  width="50%" height="50%">

## メッセージのハッシュ値に署名する方法

1. アリスは一方向ハッシュ関数でメッセージのハッシュ値を計算する
2. アリスは自分の秘密鍵でハッシュ値を暗号化する
3. アリスはメッセージと署名をボブに送信する
4. ボブは受信した署名をアリスの公開鍵で復号化する
5. ボブは受信した署名から得られたハッシュ値と、アリスから直接受信したメッセージのハッシュ値と比較する

#### アリスがメッセージに署名してからボブが署名を検証するまでの流れ

<img src="https://raw.githubusercontent.com/hiromaily/documents/main/images/degital-signature-flow.jpg"  width="50%" height="50%">

## デジタル署名の種類

- RSA によるデジタル署名
- ElGamal 方式
- DSA (Digital Signature Algorithm)
- ECDSA (Elliptic Curve Digital Signature Algorithm)
  - 楕円曲線暗号を使用したデジタル署名アルゴリズム
- Rabin 方式
