# 映像配信技術

## 基本的な概念

1. **ストリーミング vs ダウンロード**
   - **ストリーミング**: 動画データがリアルタイムでエンドユーザーに送信され、すぐに視聴可能。完全にダウンロードする前に再生が始まる。
   - **ダウンロード**: コンテンツを完全にダウンロードしてから再生する。

2. **ライブストリーミング vs オンデマンド**
   - **ライブストリーミング**: リアルタイムでのイベントの配信（例：スポーツイベント、コンサート）。
   - **オンデマンド**: ユーザーが好きな時に視聴できるプレ録画されたコンテンツ（例：Netflix、YouTube）。

## 技術とプロトコル

1. **ビデオコーデック**
   - **H.264/AVC**: 現在最も広く使用されているコーデック。高い圧縮率と品質のバランスが良い。
   - **H.265/HEVC**: H.264よりもさらに圧縮効率が高いが、デコードが少し複雑でリソースを要求する。
   - **VP9**: Googleが開発。H.265と同等の効率を持ちながら、オープンソースである。
   - **AV1**: 次世代のコーデックで、さらに圧縮効率が高い。最近普及してきている。

2. **オーディオコーデック**
   - **AAC (Advanced Audio Coding)**: 高い帯域幅効率と音質が特徴。
   - **MP3**: 広く普及しているが、圧縮効率がやや劣る。

3. **ストリーミングプロトコル**
   - **HTTP Live Streaming (HLS)**: Appleが開発。動画を小さなセグメントに分け、HTTPベースで配信。
   - **Dynamic Adaptive Streaming over HTTP (DASH)**: プラットフォームに依存せず、同様にセグメントベースのHTTPストリーミング。
   - **Real-Time Messaging Protocol (RTMP)**: Adobeによるプロトコルで、主にライブストリーミングに使用される。

4. **CDN（Content Delivery Network）**
   - **CDN**は、ユーザーの地理的ロケーションに基づいてコンテンツを分散し、低レイテンシと高スループットを実現するためのネットワーク。Akamai、Cloudflare、AWS CloudFrontなどのサービスがある。

## エンコードとデコード

- **エンコード**: 生データを圧縮し、ストリーミング向けのフォーマットに変換するプロセス。専用のエンコーディングソフトウェアやハードウェアが使用される。
- **デコード**: 圧縮されたデータをユーザーのデバイスで再生可能な形式に変換するプロセス。

## 適応型ビットレートストリーミング

- ネットワークの状態に応じて、リアルタイムでビットレートを調整する技術。HLSやDASHがこの技術を利用している。ネットワークの遅延や帯域幅の変動に対応し、最適な画質を保つことができる。

## セキュリティと著作権保護

- **DRM (Digital Rights Management)**: コンテンツの不正コピーや再配布を防ぐための技術。Widevine、PlayReady、FairPlayなどの仕組みがある。
- **HTTPS**: セキュリティのために、配信プロトコルはHTTPSを使用する。

## 音楽配信技術との違い

音楽配信も動画配信と似た技術を利用しているが、いくつかの違いや独自の要素がある

### 音楽配信の基本的な概念

1. **オンデマンドストリーミング vs ライブストリーミング**
   - **オンデマンドストリーミング**: SpotifyやApple Musicなど、ユーザーが好きな時に曲を再生できるサービス。
   - **ライブストリーミング**: コンサートやイベントのリアルタイム配信。

2. **ダウンロード vs ストリーミング**
   - **ダウンロード**: 曲をデバイスに保存し、オフラインで再生できる。
   - **ストリーミング**: ネットワークを通じてリアルタイムで音楽を再生（例: SpotifyのフリーモードやApple Musicのストリーミング再生）。

### 技術面での違い

1. **オーディオコーデック**
   - **MP3**: 広く利用されているが、圧縮効率はやや低い。
   - **AAC (Advanced Audio Coding)**: 圧縮効率と音質のバランスが良く、多くのストリーミングサービスで使用される。
   - **Opus**: 最近のコーデックで、低遅延かつ高品質。
   - **FLAC (Free Lossless Audio Codec)**: ロスレス圧縮で音質を犠牲にしないが、ストリーミングにはあまり使われない。

2. **ストリーミングプロトコル**
   - 音楽配信では、動画と同じくHLS（HTTP Live Streaming）やDASH（Dynamic Adaptive Streaming over HTTP）が利用されることが増えてきている。
   - しかし、低遅延と連続再生が求められるため、専用のプロトコルやツールが使用されることもある。

3. **ビットレート**
   - 音楽ストリーミングのビットレートは動画ほど高くない。音質と帯域幅のバランスが重要。
     - 一般的なビットレート:
       - 低: 96 kbps
       - 中: 128 kbps - 160 kbps
       - 高: 320 kbps

### 適応型ストリーミング

- 音楽配信でも、ネットワーク状態に応じてビットレートを調整する適応型ストリーミングが使用されることが多い。これにより、遅延やバッファリングを最小限に抑えつつ、最適な音質を提供する。

### メタデータとトラック情報

- **メタデータ**: タイトル、アーティスト名、アルバム名、アートワーク、ジャンルなどの情報。ID3タグやVorbisコメントなどのフォーマットでエンコードされる。
- **音楽認識技術**: Shazamや音楽ストリーミングサービスの一部は、ユーザーが聞いている曲を認識し、関連情報を提供する技術を持っている。

### レコメンデーションエンジン

- **レコメンデーションエンジン**: ユーザーの聴取履歴や好みに基づいて、新しい音楽を提案するアルゴリズム。Spotifyの"Discover Weekly"やApple Musicの"おすすめ"がこれにあたる。
- **機械学習**: ユーザーデータを解析し、個々の好みに適したコンテンツを提供する。

### CDN（Content Delivery Network）

- **CDN**は、楽曲を低遅延で提供するためのネットワーク。Akamai、Cloudflare、AWS CloudFrontなどが使われる。

### スペースと効率

- 音楽配信は、動画配信ほど大量のデータを扱うわけではないため、帯域幅の利用効率が異なる。したがって、音楽配信サービスは動画配信に比べて一般に少ないデータ量で済むが、高音質を保つための最適化が求められる。

## References

- [同接1500人耐える配信サーバーをCloudflareを使って構築した](https://zenn.dev/wawawa1234/articles/9a51a04df12da7)
