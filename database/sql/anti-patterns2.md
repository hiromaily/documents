# SQL Anti パターン まとめ2

## サーティワンフレーバー

enum などによって、限定する値を列定義で指定するアンチパターン

### 問題点と解決方法

- enum のメリット

  - テーブルの join や select の回数が減る

- 問題点
  - enum に設定してある値の一覧を取得する方法が特殊な方法になってしまう
  - 候補の変更が ALTER 文によって列を変更しなくてはいけない
  - 他の DB へ migrate する場合の互換性
  - すでに使われている値の修正が大変
  - 扱う値が将来的にも不変ならよいが、将来的に変更しうる場合には破綻する
- 解法
  - 将来的に変更しうる場合は、参照テーブルを追加し、外部キー制約で限定する

### Enum References

- [SQL アンチパターン感想その二ー ENUM 型を扱う](https://zenn.dev/convers39/articles/0e58e17d0da43f)
- [【MySQL】enum の是非について](https://note.com/standenglish/n/n552052cf4199)
- [ある選択肢のみ許容する column を定義する際の方針](https://scrapbox.io/mrsekut-p/%E3%81%82%E3%82%8B%E9%81%B8%E6%8A%9E%E8%82%A2%E3%81%AE%E3%81%BF%E8%A8%B1%E5%AE%B9%E3%81%99%E3%82%8Bcolumn%E3%82%92%E5%AE%9A%E7%BE%A9%E3%81%99%E3%82%8B%E9%9A%9B%E3%81%AE%E6%96%B9%E9%87%9D)
- [【アンチパターン】データベース物理設計](https://zenn.dev/tanakanata7190/books/55d484e6dc8b09/viewer/6d111a)

## DBの区分値の値について

[DBで区分値などのCODEは数値ではなく文字列を利用するべき](https://zenn.dev/tonbi_attack/articles/fb796ac3cf9720)

- 数値コードは、メモリ使用量が少なく、処理速度が速いという利点
- コードの意味が直感的に理解しにくいというデメリット
- 文字列コードを使う場合のメリット
  - 直感的な理解
  - 拡張性の向上: 新しい区分値の追加の容易さ
  - デバッグとメンテナンスの容易さ: エラーログの解析
- 文字列コードのデメリットと対策
  - ストレージとパフォーマンスへの影響
    - [対策] 文字列フィールドのインデックスを作成する
    - [対策] 文字列コードの長さを適切に制限する
      - あらかじめ長さが限定されているフィールドには、固定長の文字列データ型を使用することが推奨
  - 一貫性の維持が必要

実際に、最適化されたデータベース設計を用いてパフォーマンステストを行った場合、文字列コードを用いても、適切な最適化を施すことで数値コードを使用した場合と比較しても遜色ないパフォーマンスを実現できることが多くのケースで報告されているらしい
