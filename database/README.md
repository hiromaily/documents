# Database

## MySQL と PostgreSQL について

MySQL と PostgreSQL はどちらも、データの保存、整理、および管理に使用される一般的なリレーショナル データベース管理システム (RDBMS) 。 ただし、この 2 つにはいくつかの重要な違いがあり、一方が他方よりもニーズに適している場合がある。
最終的に、MySQL と PostgreSQL のどちらを選択するかは、特定のニーズとアプリケーションの要件によって異なる
。 複雑なデータ型と拡張機能を処理でき、データの整合性を優先できるデータベースが必要な場合は、PostgreSQL の方が適している可能性がある。 読み取りおよび書き込み操作が高速で、従来のレプリケーション方法で簡単にスケーリングできるデータベースが必要な場合は、MySQL がより適切な選択肢となる可能性がある。

## MySQL と PostgreSQL の違い

### 1. データの種類と拡張子

- PostgreSQL は、配列、範囲、ユーザー定義型など、MySQL よりも幅広いデータ型をサポートしている。
- PostgreSQL では、ユーザーがデータベースの機能を拡張するために使用できる独自の関数、演算子、および集計を定義することもできる。
- 一方、MySQL は、より限定されたデータ型と拡張子のセットをサポートしり。

### 2. ACID コンプライアンス

- MySQL と PostgreSQL はどちらも ACID に準拠しているため、データ トランザクションの信頼性と一貫性が保証される。
- ただし、PostgreSQL は MySQL よりも強力な ACID 準拠であることが知られており、これは高レベルのデータ整合性を必要とするアプリケーションにとって重要な場合がある。

### 3. パフォーマンス

- 読み取りおよび書き込み操作に関しては、MySQL は一般に PostgreSQL よりも高速であると考えられている。
- ただし、PostgreSQL は、より高度なクエリ オプティマイザーとより高度なインデックス作成手法のサポートにより、複雑なクエリや分析ワークロードに好まれることがよくある。

### 4. スケーラビリティ

- MySQL と PostgreSQL はどちらもスケーラブルになるように設計されていますが、これを実現するために異なるアプローチを使用している。
- MySQL は従来のマスター/スレーブ レプリケーション モデルを使用しますが、PostgreSQL はより高度なマスター/スタンバイ レプリケーション モデルを使用して、より優れたフォールト トレランスと負荷分散を可能にする。

### 5. ライセンス

- MySQL は GPL またはプロプライエタリ ライセンスに基づいてライセンスされている
- PostgreSQL は寛容な MIT ライセンスに基づいてライセンスされている
- これは、PostgreSQL が MySQL よりも自由に使用および変更できることを意味する

## SQL クエリの N+1 問題

N 件のデータ行を持つテーブルをごそっと読みだすのに 1 回、
別のテーブルから、先述のテーブルの各行に紐づくデータを（1 件ずつ）読み出すのに計 N 回、
合計で N+1 回のクエリを実行している状態

### 解決方法

- JOIN 句による表の結合
- Eager Loading

```sql
SELECT * FROM parent;
SELECT * FROM child WHERE ID IN (3, 1, 2, 1, 4);
```

## DB のユニークキー

[データベースでユニークキーに UUID を使うメリットは何ですか？](https://jp.quora.com/%E3%83%87%E3%83%BC%E3%82%BF%E3%83%99%E3%83%BC%E3%82%B9%E3%81%A7%E3%83%A6%E3%83%8B%E3%83%BC%E3%82%AF%E3%82%AD%E3%83%BC%E3%81%ABUUID%E3%82%92%E4%BD%BF%E3%81%86%E3%83%A1%E3%83%AA%E3%83%83%E3%83%88%E3%81%AF%E4%BD%95)

`プライマリキーには原則としてデータベース側で発行される自動インクリメントの連番を使っておくのが間違いない`
