# Web Rendering

レンダリングのプロセスは以下の通り

## HTTPリクエスト

### 1. URLの解析とリクエスト送信

1. **URLの解析**:
   - ユーザーがURLを入力すると、ブラウザはそのURLを解析する。
   - URLのスキーム（例えば、`https://`）、ドメイン名、パス、クエリパラメータなどを解析する。

2. **DNSルックアップ**:
   - ドメイン名をIPアドレスに変換するためにDNSルックアップを行う。

3. **HTTPリクエストの送信**:
   - IPアドレスが得られたら、指定されたリソースを取得するためにHTTPリクエストを送る。

## HTTPレスポンス

### 2. リソースの取得

1. **初期リクエストのレスポンス**:
   - サーバーはリクエストを受け取り、応答としてHTMLドキュメントを返す。

2. **追加リソースのリクエスト**:
   - HTMLドキュメントを解析しながら、ページに必要な追加のリソース（CSS、JavaScript、画像、フォントなど）を順次リクエストする。

### 3. HTML解析とDOMツリーの構築

1. **HTML解析**:
   - HTMLドキュメントを順次パース（解析）し、DOM (Document Object Model) ツリーを構築する。

2. **DOMツリーの構築**:
   - 各HTMLタグがノードとして表現され、これがツリー構造として組み立てられる。

### 4. CSS解析とCSSOMツリーの構築

1. **CSSの解析**:
   - ページにリンクされているCSSファイルも同様に取得し、パースする。

2. **CSSOMツリーの構築**:
   - CSSスタイルシートを解析して、CSSOM (CSS Object Model) ツリーを構築する。
   - CSSOMツリーはDOMツリーと並行して構築される。

### 5. レンダーツリーの構築

1. **レンダーツリーの生成**:
   - DOMツリーとCSSOMツリーを組み合わせてレンダーツリーを作成する。
   - レンダーツリーはページの表示に必要な要素だけを含む。CSSで表示が「none」とされている要素などは含まれない。

### 6. レイアウトの計算

1. **レイアウト計算**:
   - レンダーツリーの各要素の位置とサイズを計算する。
   - レイアウト（または「リフロー」）プロセスが実行され、ビューのサイズや相対的な位置情報が確定する。

### 7. ペイントとコンポジット

1. **ペイント**:
   - レイアウト計算が終わると、ブラウザは各要素のビジュアル情報（色、画像、テキストなど）をペイントする。
   - ペイントプロセスによって、ピクセル情報が生成される。

2. **コンポジット**:
   - ペイントされたピクセル情報がレイヤーに配置され、これらが最終的に画面に描画される。

## レンダリング後

### 8. ユーザーインタラクションの対応

- ページがレンダリングされた後も、JavaScriptの実行やDOMの更新、ユーザーインタラクション（クリック、スクロールなど）が発生し、これらが再びレンダリングのプロセスを引き起こす可能性がある。

この一連の流れを経て、Webページがユーザーに対して動的に表示され、インタラクションが可能になる。

## References

- [Rendering on the Web](https://developers.google.com/web/updates/2019/02/rendering-on-the-web)
