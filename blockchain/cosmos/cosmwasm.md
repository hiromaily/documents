# CosmWasm

- Cosmos SDK上で動くスマートコントラクトモジュールのこと、またはCosmos のエコシステム用に作られたスマートコントラクトプラットフォーム
- このCosmWasmを使用することで、異なるプログラミング言語を使用して開発されたアプリでもブロックチェーン上で高速に実行することができる
- CosmWasmのサンプルバイナリの提供により新しいスマートコントラクト対応のブロックチェーンを起動可能で、CosmWasm対応のブロックチェーンを作成するとカスタムコントラクトをデプロイできる
- CosmWasmによりセキュリティを気にせず独自のスマートコントラクトが構築でき、IBCを利用し、複数のチェーンで実行できる
- CosmWasmはスマートコントラクトのマルチチェーンソリューションとなるように設計されている

## マルチチェーンの定義
| 特徴                               | 説明                                                                                                                                                                                                                                                              |
| :--------------------------------- | :---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 異なるチェーンでも同じコントラクト | - ホストアプリケーションの要件がない<br> - Cosmos SDKでモジュールを埋め込み、承認・料金などを自由にカスタマイズできる<br> - 基盤となるチェーンには依存しない<br> - CosmWasmコントラクトを作成するだけでCosmosエコシステムのチェーンですぐに実行できる             |
| IBC                                | CosmWasmはアクターモデル（並行性を理論的に理解するためのフレームワーク）を含みIBCの使用に適している                                                                                                                                                               |
| 統合が容易                         | - CosmWasmの設計目標はフレームワークではなくライブラリになること・コントラクトには複数の言語に対応している<br> - ホストシステムへの要求が限定されているため、Cosmos SDKだけではなく他のフレームワークを組み込める                                                 |
| 構築                               | - CosmWasmは多くの環境に適応しブロックチェーンを接続するように設計されている<br> - スマートコントラクトを構築するための堅牢なプラットフォームになる<br> - 1つのチェーンが機能しない場合でも別のチェーンにコントラクトとDapp（分散型アプリケーション）を転送できる |

## Ethereumと比べてセキュリティーが強化されている
- CosmWasmは`アクターモデル`にもとづいており、コントラクト終了後に他のコントラクトを実行するためのメッセージを返すため、`再入可能攻撃(リエントラント)`を回避できる
- 下記の攻撃ベクトルにCosmWasmは対処している

| 攻撃ベクトルのリスト                     | CosmWasmでの対処                                                                                                                                                                                  |
| :--------------------------------------- | :------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 算術アンダー                             | Rustを使用した場合、オーバーフローが検出されるとプログラムを中止できる                                                                                                                            |
| コントラクトで避けるべきデザインパターン | - トークンが送信されたときにコントラクトは呼び出されないが現在の残高を確認できる<br> - サンプルのエスクローコントラクトは金額の支払い, 返金時に現在の残高を開放する                               |
| デリゲートコールロジック                 | CosmWasmにはコントラクトのロジック内に微妙なエントリポイントはない                                                                                                                                |
| ブロックハッシュ・タイムスタンプ最後の桁 | 安全なランダムビーコンを提供し、スマートコントラクトに公開する予定                                                                                                                                |
| チェックされていないCALLの戻り           | - 送信されたメッセージはルータによってディスパッチされる<br> - ルーターはメッセージの結果をチェックし、メッセージがエラーだった場合、トランザクション全体が中止され状態の変更がロールバックされる |

### リエントラントについて
[リエントラント（再入可能）再考](https://yuyasugano.medium.com/%E3%83%AA%E3%82%A8%E3%83%B3%E3%83%88%E3%83%A9%E3%83%B3%E3%83%88-%E5%86%8D%E5%85%A5%E5%8F%AF%E8%83%BD-%E5%86%8D%E8%80%83-a194c80f131f)