# CosmWasm

- Cosmos SDK 上で動くスマートコントラクトモジュールのこと、または Cosmos のエコシステム用に作られたスマートコントラクトプラットフォーム
- この CosmWasm を使用することで、異なるプログラミング言語を使用して開発されたアプリでもブロックチェーン上で高速に実行することができる
- CosmWasm のサンプルバイナリの提供により新しいスマートコントラクト対応のブロックチェーンを起動可能で、CosmWasm 対応のブロックチェーンを作成するとカスタムコントラクトをデプロイできる
- CosmWasm によりセキュリティを気にせず独自のスマートコントラクトが構築でき、IBC を利用し、複数のチェーンで実行できる
- CosmWasm はスマートコントラクトのマルチチェーンソリューションとなるように設計されている

## マルチチェーンの定義

| 特徴                               | 説明                                                                                                                                                                                                                                                         |
| :--------------------------------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 異なるチェーンでも同じコントラクト | - ホストアプリケーションの要件がない - Cosmos SDK でモジュールを埋め込み、承認・料金などを自由にカスタマイズできる - 基盤となるチェーンには依存しない - CosmWasm コントラクトを作成するだけで Cosmos エコシステムのチェーンですぐに実行できる                |
| IBC                                | CosmWasm はアクターモデル（並行性を理論的に理解するためのフレームワーク）を含み IBC の使用に適している                                                                                                                                                       |
| 統合が容易                         | - CosmWasm の設計目標はフレームワークではなくライブラリになること・コントラクトには複数の言語に対応している - ホストシステムへの要求が限定されているため、Cosmos SDK だけではなく他のフレームワークを組み込める                                              |
| 構築                               | - CosmWasm は多くの環境に適応しブロックチェーンを接続するように設計されている - スマートコントラクトを構築するための堅牢なプラットフォームになる - 1 つのチェーンが機能しない場合でも別のチェーンにコントラクトと Dapp（分散型アプリケーション）を転送できる |

## Ethereum と比べてセキュリティーが強化されている

- CosmWasm は`アクターモデル`にもとづいており、コントラクト終了後に他のコントラクトを実行するためのメッセージを返すため、`再入可能攻撃(リエントラント)`を回避できる
- 下記の攻撃ベクトルに CosmWasm は対処している

| 攻撃ベクトルのリスト                     | CosmWasm での対処                                                                                                                                                                             |
| :--------------------------------------- | :-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| 算術アンダー                             | Rust を使用した場合、オーバーフローが検出されるとプログラムを中止できる                                                                                                                       |
| コントラクトで避けるべきデザインパターン | - トークンが送信されたときにコントラクトは呼び出されないが現在の残高を確認できる - サンプルのエスクローコントラクトは金額の支払い, 返金時に現在の残高を開放する                               |
| デリゲートコールロジック                 | CosmWasm にはコントラクトのロジック内に微妙なエントリポイントはない                                                                                                                           |
| ブロックハッシュ・タイムスタンプ最後の桁 | 安全なランダムビーコンを提供し、スマートコントラクトに公開する予定                                                                                                                            |
| チェックされていない CALL の戻り         | - 送信されたメッセージはルータによってディスパッチされる - ルーターはメッセージの結果をチェックし、メッセージがエラーだった場合、トランザクション全体が中止され状態の変更がロールバックされる |

### リエントラントについて

[リエントラント（再入可能）再考](https://yuyasugano.medium.com/%E3%83%AA%E3%82%A8%E3%83%B3%E3%83%88%E3%83%A9%E3%83%B3%E3%83%88-%E5%86%8D%E5%85%A5%E5%8F%AF%E8%83%BD-%E5%86%8D%E8%80%83-a194c80f131f)

## References

- [Docs](https://docs.cosmwasm.com/docs/)
- [github](https://github.com/CosmWasm/cosmwasm)
