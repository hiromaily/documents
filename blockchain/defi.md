# DeFi
スマートコントラクトによって実現される分散型金融　(Decentralized Finance)

## DeFiの特徴
- 法律等の制約を受けない
- 手数料が安い
- 自由にサービス設計ができる
- 運営者はいるが、徐々に権限をコミュニティーに移譲する`分散ガバナンス`が進んでいる

## DeFiの主要サービス
### レンディング
- 資金の貸し借りを仲介者なしで取引することができる
- このサービスに預けると利子を得ることができる
- 逆に借りる場合は、利子を支払うことになる
- 借りる市場で利用できる仮想通貨が多ければ多いほど金利を低くし、利用できる仮想通貨が少なければ少ないほど金利を高くする
  - 1つの通貨では、使用率が高ければ金利が高くなる
- このロジックは公開されていることが望ましい
- 代表的なサービスは`Compound`
  - 高い利率の仮想通貨を貸し借りするほど、より多くの`COMP`と言われる`ガバナンストークン`を得ることができる
  - `ガバナンストークン`を持つ利用者が、新たなサービスを導入するか否かについて投票を行う
- 運用規模を拡大するためには、仮想通貨を預けてくれる利用者を増やすことが不可欠
  - Compoundでは、預け入れ額に応じてガバナンストークンを配布する
- 借り手側は、借り入れる際には、仮想通貨での担保を用意する必要がある
- 担保として貸し出した仮想通貨はロックされて自由に移動することができなくなる
- 借りた仮想通貨を返すことで資金ロックが解除される

### DEX (分散型取引所)
- 仮想通貨同士を交換する取引所の機能のことで、スマートコントラクトによって自動で取引がされることになる。
- 代表的なサービスは`Uniswap`で、非営利目的で運営されていて手数料がほとんど発生しない
- DeFiとしての特色は、アカウントの作成は必要なく、仮想通貨のwalletと同期させることによってswapすることができる

### AMM (Automated Market Maker)
- 現在の証券取引所システムはミリ秒以下の応答速度で注文を処理し、1秒間に数万件の処理を行うことができる
- 仮想通貨の取引では、Ethereumでは1秒間に20件程度の処理しかできない
- しかし、swap取引では、需要と供給の関係をリアルタイムに反映させることが大事
- このため、取引のルールをアルゴリズムによって制御する`自律的に機能するマーケットメーカー:AMM`が考え出された
- 2種類の仮想通貨を1:1の価値となるように組み合わせたものを`流動性プール`という
  - 例えばETHとOMGでは `1 ETH`と`500 OMG`は同じ価値となる場合、このような組み合わせをいう
  - そして流動性プールの目的は、2種類の仮想通貨ペア間の交換を円滑にするためのもの
  - 多くの人がETHからOMGにswapしたいと考えるとき、OMGの価値をあげて交換比率を柔軟に変更することが大事
  - そのアルゴリズムは`ETHの総量とOMGの総量を掛け合わせた量を不変量とする`
  - 上記の例では、流動性プールを作成した人が最初に拠出したのが、`10 ETH`と`500 OMG`とすると、両通貨の総量を掛け合わすと`5000`となり、この数値が`不変量 (invariant)`となる
  - ここで、買い手が`1 ETH`を流動性プールに預けた場合、`不変量 (5000) / ETH 総量(11) = OMG 総量 (454.5)`で、OMGの元々の総量が500なので、500-454.5の`45.5`を書いてに返却することになる
  - この結果、元々の交換比率が`1:50`だったが、この取引によって`1:45.5`に更新された
  - 尚、実際に買い手が手持ちの仮想通貨を流動性プールに送信する際に、一定の手数料が差し引かれることになる。この手数料の一部が流動性を供給した利用者に対してインセンティブとして配布される