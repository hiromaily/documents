# Blockchain Indexer

Indexer は、ブロックチェーンデータの効率的な検索とアクセスを可能にするためにデータを整理、索引化するシステムまたはサービスを指す。ブロックチェーンネットワーク上のトランザクションデータ、イベント、そしてその他の重要な情報を高速かつ効率的に検索できるようにする。

ブロックチェーンデータの検索とアクセスを効率化するための重要なツールであり、これにより開発者やユーザーは大量のデータに迅速にアクセスし、さまざまなアプリケーションやサービスを構築することが可能になる。

## なぜ Indexer が重要なのか？

ブロックチェーンは、大量のデータが記録される分散型台帳。しかし、ブロックチェーン上のデータは順次的に保存されており、検索効率が低くいことが問題となる。Indexer はこの課題を解決するため、特定の条件やクエリに応じてデータに素早くアクセスできるようにする。

## Indexer の仕組み

1. **データ収集**:
   インデクサーはブロックチェーンネットワークをスキャンし、新しいブロックやトランザクションのデータを収集する。

2. **データ抽出と整理**:
   収集されたデータから必要な情報を抽出し、適切な形式に整理する。例えば、アドレスごとのトランザクション履歴、イベントログ、スマートコントラクトのデータなどが含まれる。

3. **索引化**:
   整理されたデータをインデックスに格納する。このインデックスは、検索クエリに対して高速かつ効率的に応答するための構造化データベース。

4. **API 提供**:
   索引化されたデータにアクセスするための API を提供し、開発者やユーザーが効率的にデータを検索および取得できるようにする。

## インデクサーの主なコンポーネント

1. **データ収集エンジン（Data Ingestion Engine）**

   - **役割:**
     ブロックチェーンネットワークからデータを収集するためのコンポーネント。新しいブロックが生成されるたびに、そのブロック内のトランザクションやイベントデータを取得する。この収集プロセスは、ブロックチェーンのノードと連携して行われる。
   - **具体例:**
     特定のブロックチェーン API や RPC ノードとの連係により、イーサリアムノードからデータを取得する。

2. **データ変換および整形（Data Transformation and Normalization）**

   - **役割:**
     収集されたデータを標準形式に変換し、解析・処理がしやすい形に整形する。これは、データの一貫性を確保し、後続の処理を容易にするために必要。
   - **具体例:**
     イーサリアムの トランザクションデータを JSON 形式に変換し、必要なフィールドを抽出して整理する。

3. **索引化エンジン（Indexing Engine）**
   - **役割:**
     整形されたデータをインデックスに格納するコンポーネント。索引化エンジンは、高速検索を可能にするためにデータに適切なインデックスを作成する。
   - **具体例:**
     トランザクション ID、アドレス、トークン ID などのフィールドをキーとして使用し、索引を構築する。
4. **データストレージ（Data Storage）**

   - **役割:**
     索引化されたデータを保存するためのコンポーネント。多くの場合、高速検索と復元を可能にするためのデータベースやストレージシステムが使用される。
   - **具体例:**
     Elasticsearch、PostgreSQL、または NoSQL データベース（例：MongoDB）を使用してインデックス付きデータを格納する。

5. **クエリエンジン（Query Engine）**

   - **役割:**
     ユーザーからの検索クエリを受け取り、インデックス付きデータベースに対して効率的にクエリを実行し、結果を返すコンポーネント。
   - **具体例:**
     GraphQL エンドポイントを提供して、指定された条件に基づいてデータを検索し、API レスポンスとして結果を返す。

6. **API レイヤー（API Layer）**
   - **役割:**
     外部アプリケーションやサービスがインデクサーにアクセスできるようにするインタフェース。API レイヤーは、RESTful API や GraphQL などの標準的な API 形式を提供する。
   - **具体例:**
     The Graph の GraphQL API、または Covalent の RESTful API。

## インデクサーの役割とフロー

1. **データ収集**:
   - 新しいブロックが生成されるたびに、データ収集エンジンがそのブロックデータを収集する。
2. **データ変換**:
   - 収集された生データは、データ変換と整形コンポーネントによって標準形式に変換され、一貫性のある形式に整形される。
3. **データ索引化**:
   - 整形されたデータは、索引化エンジンを通じてインデックス付きデータベースに格納される。これにより、高速な検索が可能になる。
4. **データ保存**:
   - インデックス付きデータベースやデータストレージシステムにデータが保存される。このステップによって、データへの効率的なアクセスが可能になる。
5. **クエリ実行**:
   - ユーザーが API を呼び出すと、クエリエンジンがリクエストを解析し、インデックス付きデータベースに対してクエリを実行する。
6. **結果返却**:
   - クエリ結果が生成され、API レイヤーを通じてユーザーに返される。

## 代表的なブロックチェーンインデクサー

1. **The Graph**:
   デセントラライズされた索引化プロトコルで、アプリケーションがブロックチェーンデータに効率的にアクセスできるようにする。The Graph は、特定のデータサブグラフ（subgraph）を定義し、それに基づいてデータを抽出および索引化する。開発者は GraphQL を使用してデータにクエリを発行できる。

2. **Covalent**:
   Covalent は、ブロックチェーンからデータを抽出し、統一された API を提供するサービス。これにより、さまざまなブロックチェーンネットワークのデータに簡単にアクセスできる。

3. **Blockchair**:
   マルチブロックチェーン検索エンジンで、ビットコイン、イーサリアム、ライトコインなど、複数のブロックチェーンをサポートしている。アドレス、トランザクション ID、ブロックナンバーなどで検索が可能。

## 利用例

1. **DeFi アプリケーション**:
   分散型金融（DeFi）アプリケーションは、トランザクション履歴やユーザーのアクティビティデータに素早くアクセスする必要がある。インデクサーを使用することで、効率的にデータを取得し、ユーザーインターフェースに反映できる。

2. **データ分析**:
   ブロックチェーンデータを分析する際に、インデクサーを利用することで、大量のデータの中から必要な情報を迅速に抽出できる。これにより、市場動向の把握やユーザー行動の解析が容易になる。

3. **トークンイベント監視**:
   特定のスマートコントラクトやトークンのイベント（例：トークンの発行、送信、受信など）を監視し、リアルタイムで対応するためにインデクサーを用いることができる。

## メリットとデメリット

### メリット

1. **高速なデータアクセス**:
   インデクサーを使用することで、大量のブロックチェーンデータに対して高速かつ効率的にアクセスできる。

2. **開発の容易化**:
   索引化されたデータにアクセスするためのシンプルな API を提供することで、開発者がデータを取得しやすくなる。

3. **スケーラビリティ**:
   大量データに対するクエリ処理を高速で行うことができるため、アプリケーションのスケーラビリティが向上する。

### デメリット

1. **インデクサーの管理コスト**:
   自らインデクサーを運営する場合、データ収集、索引化、API 提供に関連する運用コストが発生する。

2. **リアルタイム性の限界**:
   インデクサーの索引化プロセスには時間がかかる場合があり、完全なリアルタイム更新には限界がある。

## References

- [What is a blockchain indexer?](https://www.alchemy.com/overviews/blockchain-indexer)
