# AWS DynamoDB

Amazon DynamoDB は、Amazon Web Services（AWS）が提供するフルマネージド型の`NoSQLデータベース`サービス。DynamoDB は高いパフォーマンスと可用性を持ちながら、大規模なデータストレージおよび検索に対応している。主な用途としては、リアルタイムの業務アプリケーション、IoT、モバイルバックエンド、ゲーム、電子商取引のシステムが挙げられる。

NoSQL の種類としては、`Key-value型 DB`であり (ワイドカラムストア型ではない)、`ドキュメント型DB`とのハイブリッド

## 主要な特徴

1. **フルマネージドサービス**：

   - インフラ管理（ハードウェアの調達、セットアップ、構成、パッチ適用、およびサーバーの運用・保守）を AWS が担当。

2. **スケーラビリティ**：

   - ストレージとスループットは自動的にスケールアップ/スケールダウンする。従来の RDBMS のように手動で構成変更を行う必要がない。

3. **高速性能**：

   - 数ミリ秒のレイテンシーで読み書き操作が可能であり、非常に高速。

4. **柔軟なデータモデル**：

   - キーバリューストアおよびドキュメントデータベースとして使用できる。JSON 形式でデータを保存し、任意の属性を持つ柔軟なデータモデルがサポートされている。

5. **高い可用性と耐障害性**：

   - データは複数のリージョンやアベイラビリティゾーンに自動的にレプリケートされ、高い可用性を提供する。

6. **セキュリティとコンプライアンス**：
   - データ暗号化、Amazon VPC との統合、IAM によるアクセス管理、統合されたモニタリング機能（AWS CloudTrail/AWS CloudWatch）等のセキュリティ機能が提供されている。

## データモデル

- **テーブル (Table)**: データのコレクション。各テーブルは名前とプライマリキー属性を持つ。
- **アイテム (Item)**: テーブル内の個々のエントリ。キーと属性を持つ。
- **属性 (Attribute)**: アイテムのプロパティ。
- **プライマリキー (Primary Key)**:
  - **パーティションキー (Partition Key)のみ**：単一の属性からなる。
  - **パーティションキーとソートキー (Sort Key)**：2 つの属性からなる複合キー。

## データ統合とクエリ

DynamoDB はデータの読み取りと書き込みを効率的に行うために、以下のようなクエリオプションを提供している：

- **GetItem, Query, Scan**: データを取得。
- **PutItem, BatchWriteItem, UpdateItem, DeleteItem**: データを操作。

## 課金モデル

DynamoDB の課金モデルは 2 タイプある：

1. **オンデマンドキャパシティモード**：読み取り・書き込みに対して実際に使用したリクエスト数に基づいて課金。
2. **プロビジョンキャパシティモード**：事前に設定したキャパシティユニットに基づいて課金。

## グローバルセカンダリインデックス (GSI)とローカルセカンダリインデックス (LSI)

- **GSI**: 異なるパーティションキーまたはソートキーを持つインデックス。更新速度がデフォルトテーブルとは独立。
- **LSI**: 元のパーティションキーを共有しながら異なるソートキーを持つインデックス。

## その他の特徴

- **DynamoDB Streams**：テーブルに対して行われた変更をリアルタイムでキャプチャする機能。
- **トランザクション**：アトミックな一貫性のある操作を保証するためのトランザクションサポート。
- **DynamoDB Accelerator (DAX)**：高速キャッシュ機能が提供され、さらにミリ秒未満のレイテンシーを実現。

## DynamoDB Streams について

DynamoDB は主にデータの保存と高速なクエリを提供するデータベースサービスであり、DynamoDB Streams はそのデータ操作の変更をリアルタイムで追跡し、他のアプリケーションやサービスで利用するための機能。この二つを組み合わせることで、強力なリアルタイムアプリケーションを構築することができる。

- **概要**: DynamoDB Streams は、DynamoDB テーブル内のデータ操作（挿入、更新、削除）の変更をリアルタイムでキャプチャする機能。
- **主な機能**:
  - **変更データキャプチャ**: テーブルの変更をリアルタイムでストリームデータとして取り扱う。
  - **イベント駆動型アーキテクチャ**: Lambda や他の AWS サービスと連携してイベントドリブンのワークフローを構築。
  - **順序保証**: ストリーム内のデータは、特定のパーティションキーごとに順序が保証される。
  - **デュレーション**: ストリームデータは最大 24 時間保持され、その間に処理が可能。

### 2 つの主な違い

- **目的**:
  - **DynamoDB**: メインのデータストレージおよびクエリーサービス。
  - **DynamoDB Streams**: DynamoDB のデータ変更を監視・キャプチャして、他のシステムやアプリケーションに反映させるためのイベントソーシングサービス。
- **データの扱い**:

  - **DynamoDB**: 永続的なデータ保存。
  - **DynamoDB Streams**: 一時的なストリームとして変更データを提供。

- **使用シナリオ**:
  - **DynamoDB**: 一般的なデータベース操作（読み取り、書き込み、クエリ、スキャン）に使用。
  - **DynamoDB Streams**: データ変更に反応してリアルタイムに処理を行う場合（例：ログ記録、データレプリケーション、リアルタイムアナリティクス）。

## ローカル環境での使用

- [DynamoDB local](https://docs.aws.amazon.com/ja_jp/amazondynamodb/latest/developerguide/DynamoDBLocal.html)を使うことができる。
- [LocalStack](https://github.com/localstack/localstack)

## MongoDB との比較

### MongoDB との共通点

1. **スキーマレス**: どちらもスキーマレスであり、ドキュメントごとに異なる構造を持つことが可能。これにより、データモデルの変更が柔軟になる。
2. **高スケーラビリティ**: どちらも大規模なデータセットに対してスケーラビリティを提供する。読み取り、書き込みのパフォーマンスを容易に拡張できる。
3. **ドキュメント型ストレージ**: JSON 形式や類似の形式でデータを保存する。MongoDB はネイティブに JSON-like な BSON 形式を使用し、DynamoDB は JSON 互換のデータを扱う。
4. **高可用性**: どちらも複数のノードにデータを複製し、高可用性と耐障害性を提供する。

### MongoDB との違い

1. **データモデルとクエリの柔軟性**:

   - **MongoDB**: リッチなクエリ言語を持ち、複雑なクエリ、ジョイン、一部のトランザクションをサポートする。アグリゲーションパイプラインも強力。
   - **DynamoDB**: クエリ言語は比較的シンプルで、ジョイン操作はサポートされていない。ただし、インデックス（グローバルセカンダリインデックス（GSI）やローカルセカンダリインデックス（LSI））を使用することで、効率的なクエリが可能。

2. **管理と運用**:

   - **MongoDB**: セルフホスティングや MongoDB Atlas を使用したフルマネージドのクラウドサービスがある。セルフホスティングの場合、ノードの管理、バックアップ、クラスタリングなどを手動で行う必要がある。
   - **DynamoDB**: フルマネージドの AWS サービスであるため、プロビジョニング、スケーリング、バックアップ、復元などを AWS が自動的に行います。運用負担が少ない。

3. **トランザクションサポート**:

   - **MongoDB**: 複数ドキュメントにまたがるトランザクションをサポートする。
   - **DynamoDB**: 以前は単一ドキュメントトランザクションのみだったが、現在では複数アイテムにまたがるトランザクションもサポートしている。

4. **パフォーマンス設定**:
   - **MongoDB**: スケーリングはシャーディングに基づいて行われ、ユーザーが手動で構成する必要がある。
   - **DynamoDB**: 自動スケーリング機能を提供し、プロビジョンドスループットモードとオンデマンドキャパシティモードを選択できる。
