# AWS Step Functions

アプリケーションのワークフローを定義、実行、監視するためのフルマネージドサービス。Step Functions は、複数の AWS サービスや分散コンポーネント間でのタスクの連携を容易にするため、アプリケーションの開発プロセスを簡素化し、信頼性を高める。

## 主な機能

1. **ワークフローの視覚化**:

   - Step Functions のワークフローは、ステートマシン（state machine）として定義され、各ステート（状態）が異なるタスクを表現する。
   - AWS Management Console を通じて、ワークフローを視覚的に確認することができる。

2. **統合**:

   - Step Functions は、AWS Lambda、Amazon S3、Amazon SNS など、複数の AWS サービスとシームレスに連携する。
   - 外部 API やサードパーティのサービスとの統合も可能。

3. **エラーハンドリングとリトライ**:

   - 自動的なエラーハンドリングとリトライメカニズムが組み込まれており、失敗したタスクのリトライやフォールバック処理を簡単に設定できる。

4. **状態管理と検査**:

   - 各タスクの状態や進行状況をリアルタイムに監視できる。
   - ログやメトリクスを収集して、ワークフローのパフォーマンスを分析できる。

5. **分岐と並列処理**:

   - 条件分岐（Choice 状態）や並列処理（Parallel 状態）を組み込むことで、複雑なワークフローも構築可能。

6. **タイムアウトと遅延**:
   - 各ステートに対してタイムアウトや遅延時間を設定することができる。これにより、タスクが指定した時間内に終了しない場合にエラーハンドリングを行える。

## ユースケース

- **データパイプラインの自動化**: 例えば、ETL（Extract, Transform, Load）プロセスのステップを自動実行。
- **マイクロサービスのオーケストレーション**: 異なるマイクロサービス間の連携を管理。
- **バッチ処理**: 大量のデータ処理や画像、ビデオのバッチ処理など。
- **業務プロセスの自動化**: 例えば、注文処理やカスタマーサポートのワークフローを自動化。

## 設定方法

1. **ステートマシンの定義**:

   - JSON フォーマットでワークフローを定義する。
   - 定義には各ステートの種類、次に遷移するステート、エラーハンドリング、リトライの設定などを含む。

2. **タスクの実行**:

   - 定義したステートマシンを実行し、開始と各ステートの完了時にイベントが生成される。

3. **モニタリングとログ**:
   - AWS Management Console、AWS CloudWatch などを使って、実行状況を監視およびログを確認する。

## 例: Hello World のステートマシン

```json
{
  "Comment": "A Hello World example of the Amazon States Language using a Pass state",
  "StartAt": "HelloWorld",
  "States": {
    "HelloWorld": {
      "Type": "Pass",
      "Result": "Hello, World!",
      "End": true
    }
  }
}
```

## References

- [そのLambda、本当に必要ですか…？Step Functionsのすゝめ](https://blog.usize-tech.com/stepfunctions-without-lambda/)
