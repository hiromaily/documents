# AWS デッドレターキュー (DLQ)

デッドレターキュー (DLQ) は、メッセージが通常のキューで処理できない場合にそのメッセージを保存するための特殊なキュー。これにより、メッセージの損失を防ぎ、何が問題なのかを後で調査して修正するための機会を提供する。

## 一般的に使用されるデッドレターキューのいくつかの主要な例とその使用方法

### 1. Amazon SQS (Simple Queue Service)

Amazon SQS では、標準キューまたは FIFO (First-In-First-Out) キューを使用するときに DLQ を設定することがでる。DLQ を設定することで、メッセージが指定された最大受信試行回数を超えた場合に、そのメッセージが元のキューから削除されて DLQ に送信される。

**設定手順**:

1. SQS コンソールにアクセスし、対象のキューを選ぶ。
2. キュー属性の編集セクションで、デッドレターキューの設定を行う。
3. DLQ として使用する別の SQS キューを選択する。
4. メッセージ受信試行回数 (最大受信数) を設定する。

### 2. Amazon SNS (Simple Notification Service)

Amazon SNS も DLQ をサポートしている。SNS トピックの配信が失敗するたびに、そのメッセージを DLQ に送信するよう設定できる。これにより、配信失敗の原因を調査するためのメッセージを保持できる。

**設定手順**:

1. SNS コンソールで対象のトピックを選ぶ。
2. トピック属性を編集し、デッドレターキューの設定セクションを見つける。
3. SNS DLQ として使用する SQS キューを選択する。

### 3. AWS Lambda

AWS Lambda 関数でも、失敗したイベントを DLQ に送信するよう設定できる。これにより、Lambda 関数の実行中に失敗したイベントを保存しておき、後で調査や再処理を行うことができる。

**設定手順**:

1. Lambda コンソールで対象の関数を選ぶ。
2. 関数の設定セクションに移動し、デッドレターキューの設定を編集する。
3. Amazon SQS キューまたは Amazon SNS トピックを DLQ として選択する。

## DLQ の主なメリット

- **メッセージの保管**: 処理に失敗したメッセージを失わないように保管できる。
- **再試行と分析**: なぜメッセージが処理に失敗したのかを後から分析できる。
- **システムのロバスト性向上**: システムの信頼性とロバスト性を向上させることができる。
