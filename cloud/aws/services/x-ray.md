# AWS X-Ray

アプリケーションの分散トレーシング（Distributed Tracing）をサポートする。X-Ray を使用することで、マイクロサービスアーキテクチャなどの複雑な分散システムにおける動作を詳細に解析し、パフォーマンスの問題やエラーの発生地点を特定することが可能。APM（Application Performance Management）ツールの一種でもある。

## 主な機能

1. **トレースの収集と分析**：

   - アプリケーションの一連のリクエストを追跡し、エンドツーエンドのパフォーマンスを解析できる。
   - "セグメント"というコンポーネントごとのユニットを収集し、これを元に"トレース"として全体のリクエストの流れを可視化する。

2. **エラーデータの分析**：

   - HTTP エラー、サーバー例外、タイムアウトなどの詳細なエラーデータを収集し、問題の原因を迅速に特定する。

3. **サービスマップの可視化**：

   - X-Ray はサービスマップを生成し、マイクロサービス間の依存関係や通信の流れをグラフィカルに表示する。

4. **パフォーマンス指標の収集**：

   - レスポンスタイム、スループット、エラー率、防止されていないエラー生成などの指標を解析する。

5. **サンプルリング**：
   - リクエストのサンプリングを用いて、高トラフィックの環境でも効率的にトレースデータを収集する。

## 使用方法

1. **初期設定**：

   - AWS 管理コンソールを使用して X-Ray を有効化する。

2. **SDK の統合**：

   - AWS が提供する X-Ray SDK を利用して、アプリケーションにトレースの収集コードを追加する。
   - AWS Lambda、Amazon EC2、ECS, API Gateway など様々な AWS サービスとネイティブ連携する。

3. **デプロイ方法**：

   - X-Ray デーモンをインストール・設定し、デプロイ環境に配備する。

4. **データ収集**：

   - リクエストのトレースデータが X-Ray に送信され、管理コンソールで解析結果を確認できる。

5. **解析とモニタリング**：
   - X-Ray コンソールで、サービスマップの確認やトレースデータの詳細解析を行い、パフォーマンスのボトルネックやエラーの発生原因を調査する。

## 利用ケース

- **マイクロサービスのモニタリング**：複数のマイクロサービスが協調して動作する場合のパフォーマンスとエラーを詳細に解析。
- **パフォーマンスの最適化**：リクエストの遅延部分を特定し、効率的な最適化作業を実施。
- **デバッグとトラブルシューティング**：本番環境で発生する問題の迅速な特定と解決。

## 実装方法

## References

- [内部Docs: Distributed Tracing / 分散トレーシング](../../../monitoring/distributed-tracing.md)
- [内部Docs: OpenTelemetry](../../../monitoring/open-telemetry.md)
- [AWS Distro for OpenTelemetry と AWS X-Ray](https://docs.aws.amazon.com/ja_jp/xray/latest/devguide/xray-services-adot.html)
  - `AWS Distro for OpenTelemetry`は、`ADOT`と略される
- [AWS Distro for OpenTelemetry Lambda](https://aws-otel.github.io/docs/getting-started/lambda)
