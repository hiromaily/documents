# ECS on Fargate

Amazon Elastic Container Service（ECS）は、完全マネージドのコンテナオーケストレーションサービス。Fargate は、ECS と Amazon EKS（Elastic Kubernetes Service）のためのサーバレスコンピューティングエンジン。Fargate を使用すると、`ユーザーは基盤となるインスタンス（サーバー）を管理することなく、コンテナを実行できる`。

Amazon ECS on Fargate は、サーバーレスでのコンテナ管理を可能にする強力なツール。インフラ管理の手間を最小限に抑え、自動スケーリングと高可用性を提供する。特に、マイクロサービスアーキテクチャやバッチ処理、API サーバーなどに適しており、迅速なデプロイメントと効率的なリソース管理が求められるプロジェクトに最適。

これを利用することで、インフラに煩わされることなく、コアビジネスやアプリケーション開発に集中することができる。

## 特徴

1. **サーバレス**

   - インフラストラクチャの管理が完全に抽象化されており、ユーザーはコンテナ自体の定義とデプロイに集中できる。

2. **スケーラビリティ**

   - タスクの数や容量に応じて自動的にスケーリング可能。手動でのリソースプロビジョニングや管理が不要。

3. **高い可用性**

   - AWS のインフラストラクチャを利用して、高い耐障害性と可用性を提供する。

4. **セキュリティ**

   - IAM ポリシーを使って細粒度のアクセス制御が可能。各コンテナに個別の IAM ロールを割り当てることができる。
   - ネットワークセキュリティは、AWS VPC に完全に統合されている。

5. **コスト効率**

   - 使った分だけの課金。サーバーベースの料金モデルとは異なり、利用したリソースに応じた従量制課金。

6. **シンプルな統合**
   - 他の AWS サービス（CloudWatch, IAM, VPC, CloudTrail など）との統合が簡単。

## Amazon ECS on Fargate のアーキテクチャ

1. **タスク定義**

   - コンテナの設定（イメージ、メモリ、CPU、環境変数、ボリューム、ポートなど）を指定する JSON 形式のテンプレート。

2. **タスク**

   - タスク定義に従って実行される単一または複数のコンテナインスタンス。

3. **サービス**

   - ECS サービスは、一連のタスクを実行し、その状態を維持する。指定された数のタスクが常に実行されるように管理する。

4. **クラスター**
   - 一連のタスクやサービスを含むコンテナの論理集合体。Fargate では基盤となる EC2 インスタンスを管理する必要がない。

## 使用手順

### 1. タスク定義の作成

1. **ECS コンソールにアクセス**

   - AWS マネジメントコンソールにログインし、ECS のダッシュボードにアクセス。

2. **タスク定義を作成**
   - 「Create new Task Definition」をクリックし、「Fargate」を選択。
   - 必要な設定を入力（タスク名、コンテナの定義、リソースの要求など）。

### 2. クラスターの作成

1. **新しいクラスターを作成**

   - 「Create Cluster」をクリックし、「Networking only」を選択。

2. **クラスター名と設定**
   - クラスター名を指定し、VPC およびサブネット設定を確認。

### 3. サービスの作成

1. **サービスを作成**

   - 「Create Service」をクリックし、Fargate タイプのサービスを選択。
   - タスク定義とクラスターを選択し、サービス名、タスク数、デプロイメント設定などを入力。

2. **ネットワーク設定**

   - VPC、サブネット、セキュリティグループを選択。

3. **ロードバランシングオプション**
   - 必要に応じて、Application Load Balancer（ALB）や Network Load Balancer（NLB）を設定。

### 4. デプロイとモニタリング

1. **デプロイ**

   - 設定を確認し、「Create Service」をクリックしてサービス作成を完了。

2. **モニタリング**
   - ECS ダッシュボードからタスクやサービスのステータスをモニタリング。
   - CloudWatch を利用してパフォーマンスメトリクスを監視。

## メリットとデメリット

**メリット**

- **サーバレス運用**: インフラ管理の手間を削減、完全にサーバレスでコンテナを実行。
- **スケーラビリティ**: 自動スケーリングにより、需要に応じてリソースを調整。
- **高可用性とセキュリティ**: AWS のインフラを利用した高い可用性及びセキュアな運用が可能。
- **コスト効率**: 使った分だけの従量制課金。

**デメリット**

- **カスタマイズの制約**: EC2 インスタンスベースの ECS に比べ、底層のインフラストラクチャカスタマイズが制限される。
- **初期設定の複雑さ**: タスク定義やネットワーク設定、セキュリティ設定の初期設定が複雑。

## 具体的な使用例

1. **マイクロサービス**

   - 各サービスを独立したコンテナとして管理し、容易にスケーリング可能。

2. **バッチ処理**

   - 定期的なバッチジョブをコンテナとして実行し、スケジュール管理が不要。

3. **API サーバー**

   - 高可用性の API バックエンドとして、需要に応じたスケーリングが可能。

4. **CI/CD パイプライン**
   - 自動化されたテストやデプロイメントプロセスの一部として利用。
