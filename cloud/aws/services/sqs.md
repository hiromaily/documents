# AWS SQS / Amazon Simple Queue Service

メッセージキューサービス。SQS を使用することで、分散アプリケーションやマイクロサービス間の通信を非同期に行うことができ、システムのスケーラビリティや信頼性を向上させることができる。

## 1. メッセージキューの種類

SQS には主に 2 種類のキューがある

- **標準キュー（Standard Queue）**

  - **高スループット**: 大量のメッセージを短時間で送受信できる。
  - **少数の重複メッセージ**: 高可用性を確保するため、まれにメッセージが重複して配信される可能性がある。
  - **順序保証なし**: メッセージの順序が保証されない。

- **FIFO キュー（First-In-First-Out Queue）**
  - **順序保証**: メッセージを送信した順序で受け取ることができる。
  - **重複なし**: メッセージの重複が排除される。
  - **スループット制限**: 標準キューほど高いスループットがないが、厳密な順序制御が必要な場合に使用される。

## 2. メッセージの属性

SQS のメッセージには、以下の情報を含めることができる

- **メッセージ本文**: 最大 256KB のテキストやバイナリデータ。
- **メッセージ属性**: 追加のメタデータを含めることができ、検索やフィルタリングに使用する。

## 3. メッセージの可視性タイムアウト

- **可視性タイムアウト**: メッセージを受信してからの一定期間、他のコンシューマーにそのメッセージが見えないようにする機能。この期間内に処理を完了しない場合、メッセージが再度可視化され、他のコンシューマーに再配信される。

## 4. デッドレターキュー（DLQ）

- 処理に失敗したメッセージを別のキューに移動させる機能。メッセージが一定回数（最大受信試行回数）以上処理に失敗した場合に DLQ に送られることで、問題のあるメッセージを後から確認・処理できる。

## 5. 実装の簡便さとスケーラビリティ

- **管理不要**: SQS はフルマネージドサービスであり、サーバーの管理やスケーリングは不要。
- **スケーラブル**: アプリケーションの負荷に応じて自動的にスケールするため、大量のメッセージを扱う場合でも安心。

## 6. セキュリティ

- **IAM ポリシー**: SQS キューに対するアクセスコントロールを IAM ポリシーで設定可能。
- **暗号化**: メッセージの暗号化を使うことで、データ保護の強化が可能。

## 7. 利用料金

- **ペイ・アズ・ユー・ゴー**: 使用したリソースに応じた従量課金制モデル。メッセージの送受信やデータ転送量に基づいて料金が発生。

## 8. 使い方の基本

- **キューの作成**: AWS マネジメントコンソールや AWS CLI、API を用いてキューを作成。
- **メッセージの送信**: メッセージ本文と必要に応じて属性を設定してキューに送信。
- **メッセージの受信**: キューからメッセージを取得し、処理後に削除。

## 9. 用例

- **マイクロサービス間の非同期通信**: サービス間のデカップリングにより、各サービスの独立したスケーリングが可能。
- **タスクキューイング**: バックグラウンドタスクの管理や、バッチ処理の並列実行。
- **イベント駆動型アーキテクチャ**: アプリケーション間でイベント情報をやり取りし、リアクティブなシステムを構築。

## キューの作成と削除の基本ステップ

1. **キューの作成**: 処理を開始する前に新しいキューを作成する。これには AWS マネジメントコンソール、AWS CLI、またはSQS APIが利用できる。
2. **メッセージの送信**: 処理対象のデータをこのキューにメッセージとして送信する。
3. **ワーカーによる処理**: ワーカーがこのキューからメッセージを受信し、それぞれのメッセージを処理する。
4. **処理完了の確認**: すべてのメッセージが処理され、キューが空であることを確認する。
5. **キューの削除**: 処理が完全に終わったらキューを削除する。
