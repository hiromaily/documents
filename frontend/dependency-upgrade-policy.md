# Dependency Upgrade Policies

[Reference: Sentry](https://develop.sentry.dev/frontend/upgrade-policies/)

## 哲学

- react、emotion、typescript、@babel などのコアパッケージは、常に最新の状態に保つ必要がある。
  - これらのパッケージには最小限の依存関係しかなく、一般的にアップグレードパスがきちんと文書化され、熟慮されている。
  - コアな依存パッケージのアップデートは、メジャーバージョンアップの限界コストが増加するため、交渉の余地がない。
  - このようなパッケージでは、メジャーアップグレードを 1 ～ 2 ヶ月経過するまで遅らせるのも良い考えかもしれない。
- 常にパッチ版をリリースしているパッケージのアップグレードは 避ける。
  - パッケージが安定してからアップグレードすることを優先する。
- サブ依存を取り除くアップグレードが望ましい
  - インストールされるパッケージは少なければ少ないほどいい。
  - これは、deploy するコードが少なくなり、ライブラリ固有のバグが発生する可能性が低くなることを意味する。
- 不一致の共有サブ依存の数を減らすアップグレードが望ましい
  - パッケージのマイナーバージョンアップが、他のトップレベルパッケージと同じバージョンの依存関係を共有することを意味する場合、これは deploy されるコードの量を減らす。
- jest、eslint、prettier のようなクリティカルでないパッケージのアップグレードは、時間の許す限り行うことができる。
  - 例えば、すべてのテストがパスし、すべてが問題なさそうであれば、アップグレードするのは当然のこと

## バランスの取れたアプローチを取る

アップグレードは諸刃の剣であることを理解すること。

すべてを停滞させ、何もアップグレードしないままにしておくと、単にすべてが機能するからというだけで、必然的に、新しいセキュリティパッチや、コードの保守性を高めるための機能、最悪の場合、別の依存関係をアップグレードできるようにするために、パッケージをアップグレードしなければならなくなる。

パッケージのマイナーバージョンやメジャーバージョンが古くなると、膨大な作業量になる可能性がある。アップグレードが困難になった場合、エンジニアはアップグレードを完全に避け、その必要性を回避するためにハックを実装することを選ぶかもしれない。これはもちろん二重に悪いことで、アップグレードがどうしても必要になったとき、非常に古いパッケージをアップグレードするのが難しいだけでなく、今度はそのハックを理解して元に戻さなければならない。

積極的にメジャーバージョンとマイナーバージョンに対応することで、私たちは通常、パッケージの小さな変更点のみを考慮する必要がある。これは、単純に検証する部分が少ないので、パッケージの使い方が壊れる可能性が低くなり、安全。これはまた、最新のパフォーマンス・アップデート、バグ修正、セキュリティ・パッチに対応する助けにもなる。また、開発者がパッケージの使い方に関するドキュメントを探しているときに、古いバージョンのドキュメントを探す必要がなくなる。

## メリットとリスクを考える

一方、パッケージを常に最新バージョンにアップデートし続けるという選択は、多くの結果をもたらす可能性がある。

- アップグレードは場合によっては、わずかな利益のために自明でない労力を要することがある。小さなアップグレードであっても検証には時間がかかり。
  - あまりに長い間待っていると、パッケージのアップグレードは指数関数的に手間がかかるようになる
- package.json が増えすぎると、開発者は git pull のたびに yarn install を実行しなければならなくなる。
- 新しいバージョンでは、以前は存在しなかったセキュリティ脆弱性が導入される可能性がある。
  - もしパッチが出るまでアップグレードを待っていれば、脆弱性を受けることはなかっただろう。
- パッケージの新しいバージョンには、メンテナによって導入された新しい欠陥が含まれている可能性があり、それは検証中に検出するのが難しいかもしれない。

全体として、パッケージのアップグレードに対する私たちのアプローチは、 アップグレードの潜在的な利点と欠点の両方を考慮した、バランスの取れたもの。私たちのコードベースにとって正しい選択であることを確実にするために、 それぞれのアップグレードの決定を慎重に検討する必要がある。このガイドラインによって、コードベースを最新で安全な状態に保ちつつ、 不必要な労力や潜在的なリスクを避けることができる。
