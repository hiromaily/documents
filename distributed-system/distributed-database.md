# 分散データベース

参照: [内部 Docs:NoSQL](../database/nosql/README.md) or [内部 Docs:NewSQL](../database/newsql/README.md)

## 分散データベースにおけるコンセンサスアルゴリズム

分散データベースにおけるコンセンサスアルゴリズムは、複数のノードが協力し合って一貫した状態を保つためのメカニズム。これらのアルゴリズムは、分散システムにおいて`信頼性`、`高可用性`および`データ一貫性`を確保するために不可欠。

各コンセンサスアルゴリズムは、特定の用途やシステム要件に合わせて設計されている。選択する際には、データの一貫性、可用性、パフォーマンス、信頼性などの要因を考慮する必要がある。

以下は、代表的なコンセンサスアルゴリズムについて

### 1. Paxos

Paxos は、耐障害性と一貫性を重視した分散システム向けのコンセンサスアルゴリズム。以下が基本的な動作：

- **プロポーザルの作成（Propose）**: 一つのノード（リーダー）が提案を作成し、他のノードに送信する。
- **アクセプタンス（Accept）**: 他のノードが提案を受け入れるかどうかを投票し、多数のノードが同意した時に提案が承認される。
- **コミットメント（Commit）**: 提案が承認されたら、それが最終的な決定として全てのノードにコミットされる。

### 2. Raft

Raft は Paxos よりも理解しやすく設計されたコンセンサスアルゴリズム。Raft のプロセスは以下の通り：

- **リーダーの選出（Leader Election）**: クラスタ内で一つのノードをリーダーとして選出する。他のノードはフォロワーとして動作する。
- **ログのレプリケーション（Log Replication）**: クライアントからのリクエストをリーダーが受け取り、他のフォロワーに対してログエントリを複製する。
- **安全なコミットメント（Safety and Commit）**: リーダーは過半数のフォロワーから承認を得たログエントリをコミットし、データ一貫性を保証する。

### 3. PBFT (Practical Byzantine Fault Tolerance)

PBFT は、不誠実なノードの存在を想定した環境でのコンセンサスアルゴリズムである「ビザンチン障害」を扱う。以下が主要プロセス：

- **リクエスト（Request）**: クライアントがリクエストをプライマリレプリカに送信する。
- **プリプレップ（Pre-prepare）**: プライマリがリクエストを他のレプリカに配送する。
- **プレップ（Prepare）**: 各レプリカは他のレプリカからのメッセージを受け取り、それを準備段階とする。
- **コミット（Commit）**: 過半数以上の「準備完了」メッセージが集まったら、各レプリカはリクエストをコミットする。

### 4. Zookeeper's ZAB (Zookeeper Atomic Broadcast)

ZAB は Apache ZooKeeper におけるコンセンサスアルゴリズムであり、可用性と順序保証を提供する。ZAB は主に以下のフェーズで構成される：

- **フェーズ 1：リーダー選出（Leader Election）**
- **フェーズ 2：同期（Synchronization）**: リーダーとフォロワー間でのデータ同期。
- **フェーズ 3：ブロードキャスト（Broadcast）**: クライアントリクエストのブロードキャストとコミット。
