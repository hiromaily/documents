# etcd

etcd は、分散システムにおける構成情報を保存および管理するためのオープンソースの`分散Key-Value Store`です。特に、クラスタ環境やコンテナオーケストレーションシステム（例：Kubernetes）で広く利用されている。etcd は、Google の Chubby インフラストラクチャから影響を受け、CoreOS（現在は Red Hat の一部）が開発した。

etcd は、`分散システムにおけるデータ一貫性、高可用性、およびリアルタイムの設定管理を実現するための強力なツール`。`Raft` をベースにした堅牢なコンセンサスアルゴリズムと使いやすい API により、さまざまなユースケースで利用されている。

## 主な特徴

1. **高可用性（High Availability）**: etcd は、Raft コンセンサスアルゴリズムを使用して分散システム間のデータ一貫性を保証する。これにより、ノード障害やネットワーク分離の発生時でもデータの一貫性と可用性を維持する。
2. **強い一貫性（Strong Consistency）**: etcd はリーダー-フォロワーのレプリケーションモデルを使用し、全てのクライアントが強い一貫性を持った最新のデータを取得できるようにしている。
3. **ウォッチ（Watch）機能**: クライアントは特定のキーやプレフィックスに対して変更を監視することができる。変更が発生すると即座に通知されるため、リアクティブなシステムの構築が可能。
4. **トランザクション（Transactions）**: etcd は一連の操作を一つの原子性のあるトランザクションとして実行する機能を備えている。これにより、複雑なデータ管理要求に対応できる。
5. **セキュリティ**: SSL/TLS による通信の暗号化、認証、アクセス制御リスト（ACL）など、複数のセキュリティ機能を提供している。

## アーキテクチャ

etcd クラスタは以下のコンポーネントから構成される：

- **クラスタノード（Cluster Nodes）**: etcd クラスタは複数のノードから構成され、通常、奇数個のノード（例：3、5、7）が推奨される。これにより、リーダー選出とデータの一貫性が最適化される。
- **Raft コンセンサスアルゴリズム**: etcd は Raft を使用してコンセンサスを達成し、リーダーとフォロワー間でログをレプリケーションしながらデータの一貫性を保つ。

## 主な操作

1. **キーの設定（Put）**: 特定のキーに対して値を設定。

   ```sh
   etcdctl put mykey "This is a value"
   ```

2. **キーの取得（Get）**: 特定のキーの値を取得。

   ```sh
   etcdctl get mykey
   ```

3. **キーの削除（Delete）**: 特定のキーを削除。

   ```sh
   etcdctl del mykey
   ```

4. **ウォッチ（Watch）**: 特定のキーやプレフィックスに対して変更を監視。

   ```sh
   etcdctl watch mykey
   ```

5. **トランザクション（Txn）**: CAS（Compare-And-Swap）のようなコンディショナルな操作を実行できる。

   ```sh
   etcdctl txn
   ```

## 使用例とユースケース

1. **Kubernetes**: etcd は Kubernetes のメタデータと設定情報を保存するための主要なデータストアとして使用される。例えば、ポッド情報やサービスのエンドポイント情報を管理する。
2. **サービスディスカバリ**: サービスのインスタンスやアドレス情報を動的に管理し、サービスディスカバリを実現する。
3. **設定管理**: アプリケーションやサービスの設定情報を集中管理し、動的に設定を変更・反映するためのストア。
