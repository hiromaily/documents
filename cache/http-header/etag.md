# HTTP Response Header `ETag`

`ETag`（Entity Tag）ヘッダーは、`HTTPレスポンスヘッダー`の一つで、特定のリソースのバージョンや状態を識別するための一意なタグを提供する。このタグによって、同じリソースが変更されたかどうかを効率的に確認できる。

これはサーバーサイドで実装が必要となる。

## `ETag`の利用方法

### 1. レスポンスで`ETag`を提供する

サーバーはレスポンスに`ETag`ヘッダーを含めて、リソースの現在の状態を表す一意なタグをクライアントに送信する。このタグはリソースが変更されるたびに更新される。

### 2. リクエストで`If-None-Match`ヘッダーを使用する

クライアントは再度同じリソースをリクエストする際に、最後に受け取った`ETag`値を`If-None-Match`ヘッダーに含めて送信する。これにより、サーバーはリソースが変更されたかどうかを判断できる。

- 変更されていない場合：
  サーバーは`304 Not Modified`ステータスを返し、リソースのボディを送信しない。

- 変更されている場合：
  リソースの新しい内容と新しい`ETag`を含む標準のステータスコード（例: `200 OK`）を返す。

## `ETag`を使った具体例

### サーバーレスポンス

クライアントが最初にリソースをリクエストした際に、サーバーがレスポンスとして`ETag`を含めて返す例：

```http
HTTP/1.1 200 OK
Content-Type: application/json
ETag: "abc123"

{
  "id": 1,
  "name": "Example Resource",
  "updated": "2023-10-05T10:00:00Z"
}
```

### クライアントのリクエスト

クライアントが再度同じリソースをリクエストする際に、`If-None-Match`ヘッダーを使って`ETag`を送信する例：

```http
GET /resource/1 HTTP/1.1
Host: example.com
If-None-Match: "abc123"
```

### サーバーレスポンス（変更なし）

リソースが変更されていない場合、サーバーは`304 Not Modified`ステータスを返す：

```http
HTTP/1.1 304 Not Modified
ETag: "abc123"
```

### サーバーレスポンス（変更あり）

リソースが変更されている場合、サーバーは新しい内容と新しい`ETag`を返す：

```http
HTTP/1.1 200 OK
Content-Type: application/json
ETag: "def456"

{
  "id": 1,
  "name": "Updated Resource",
  "updated": "2023-10-06T12:00:00Z"
}
```

## ETag ヘッダーが有用な理由

- **ネットワーク負荷の軽減**：
  レスポンスのボディを送信せずに、必要なリソースが更新されていないことを通知できるため、帯域幅の節約になる。

- **パフォーマンスの向上**：
  クライアント側のキャッシュを効果的に管理し、リソースの取得時間を短縮できる。

- **データ整合性**：
  リソースの状態を正確に追跡し、キャッシュが最新の状態であることを保証する。

これにより、ETagは効率的なキャッシュ管理とリソースの更新確認のための強力なツールとなる。
