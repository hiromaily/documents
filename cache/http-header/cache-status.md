# HTTP Header `Cache-Status`

HTTP レスポンスに含まれるヘッダの一つで、キャッシュサーバーがレスポンスをどのように扱ったかを示す。これにより、開発者や運用者はキャッシュの動作を詳細に把握し、問題のトラブルシューティングやキャッシュの有効性を評価するのに役立つ。

キャッシュの有効性を最大化し、レスポンス時間を短縮することができる。Cache-Statusヘッダは特に複雑なキャッシュ構成を管理する際に非常に有用。

## Cache-Status の基本構造

Cache-Status ヘッダ

```txt
Cache-Status: cacheName, param1=value1, param2=value2, ...
```

このヘッダは複数のパラメータを含むことができる。

### 主なパラメータ

- **hit**: リクエストがキャッシュヒットしたことを示す。`hit=1`の場合、キャッシュからのヒットを意味する。
- **fwd**: リクエストがキャッシュをバイパスした理由を示す。例えば、`fwd=uri-miss`は本来のリクエストの URI が見つからなかったためのフォワードなどを示す。
- **ttl**: キャッシュされたレスポンスの再利用可能時間 (Time to Live) を秒単位で示す。
- **stored**: レスポンスが新たにキャッシュに保存されたことを示す。`stored`が付加されることで確認できる。
- **collapsed**: 複数のクライアントリクエストが単一のバックエンドリクエストにマージされたことを示す。
- **key**: キャッシュキーの値を示す。キャッシュキーは、キャッシュシステムがレスポンスを保存および取得するために使用する識別子。

## Cache-Status の使用例

1. **キャッシュヒットの場合**:

   ```txt
   Cache-Status: my-cache; hit=1; ttl=3600; key="12345"
   ```

   これは、my-cache というキャッシュからレスポンスがヒットされ、再利用可能時間が 3600 秒、キャッシュキーが"12345"であることを示す。

2. **キャッシュミスの場合**:

   ```txt
   Cache-Status: my-cache; fwd=uri-miss; stored
   ```

   これは最初はキャッシュされていなかったためリクエストがフォワードされ、レスポンスが新たにキャッシュされたことを示す。

## HTTP キャッシュのトラブルシューティングへの応用

Cache-Status ヘッダを用いることで、以下のようなトラブルシューティングが可能：

- 予期しないキャッシュミスの原因を特定。
- TTL の設定を確認してキャッシュリフレッシュのタイミングを調整。
- キャッシュキーの適切性を評価。
