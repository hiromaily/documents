# Layered Architecture

- `レイヤードアーキテクチャ`は、`n層アーキテクチャ`としても知られており、最も一般的なアーキテクチャスタイルの 1 つで、シンプルさや親しみやすさ、コストの低さから、ほとんどのアプリケーションにとってのデファクトスタンダードとなっている
- 組織はそのコミュニケーション構造をコピーしたシステムを設計するように制約されているという、[コンウェイの法則](https://oreil.ly/Rb4uN) が多くの組織において働きやすい。ほとんどの組織には、ユーザーインターフェイス（UI）の開発チーム、バックエンドの開発チーム、ルール開発チーム、データベース管理チーム（DBA）がいる。こうした組織構造は、伝統的なレイヤードアーキテクチャの各層にうまくフィットしており、多くのビジネスアプリケーションにとって自然な選択となっている。
- レイヤードアーキテクチャは、`暗黙のアーキテクチャアンチパターン`や`偶発的アーキテクチャアンチパターン`といった`アンチパターン`にも該当する

## 技術によって分割されたアーキテクチャという特性

- レイヤードアーキテクチャは、ドメインによって分割されたアーキテクチャとは対照的な、技術によって分割されたアーキテクチャ
- そのため特定のビジネスドメインがアーキテクチャの全ての層に散らばってしまうため、ドメインの変更が容易ではない。そのため、ドメイン駆動設計のアプローチはレイヤー度アーキテクチャーと相性が悪い。

## レイヤーの分離

- 各レイヤーは`閉鎖レイヤー`と`解放レイヤー`のいずれかとなる
  - `閉鎖レイヤー` ... リクエストがレイヤーを上からしたへ移動していく際に、いずれにレイヤーもスキップせずに直下の層を経由していかなければならない
  - `閉鎖レイヤー` ... このレイヤーはスキップすることが許容される

## 標準的な論理レイヤー

- Presentation Layer
  - UI と Backend の通信ロジックに責務を持つ
- Business Layer
  - リクエストに関連した特定のビジネスルールの実行に責務がある
- Persistence Layer
  - SQL などはここに含まれる
- Database Layer
  - 独立した外部の Database など

これはアプリケーションの規模によって 3 層だったり 5 層だったりと異なる

<img src="https://raw.githubusercontent.com/hiromaily/documents/main/images/layered-architecture.webp"  width="50%" height="50%">

## DDD の文脈で語られる 4 つのレイヤー

- Presentation (User Interface)
  - ユーザーがアプリケーションと対話するために使用する UI を構築し、ユーザーの入力をアプリケーションのコマンドに変換する責任を持つ
- Application
  - ユーザーが必要とするタスクを実行するために、Domain オブジェクトを編成する。ビジネスロジックは含まれない。Clean Architecture における`ユースケース`にあたる。
- Domain
  - これは、すべてのビジネスロジック、Entity、Event を含むその他のオブジェクトタイプを含む層。Clean Architecture における`Entity`にあたる
- Infrastructure
  - 上記のレイヤーをサポートする技術的能力、すなわち永続性やメッセージングなどが含まれる

<img src="https://raw.githubusercontent.com/hiromaily/documents/main/images/layered-architecture%2Bddd.png"  width="50%" height="50%">

## 利点

- シンプルさ
- 一貫性
- 閲覧性

## 欠点

- デプロイ容易性が低い
- テスト容易性が低い
- スケーラビリティーの欠如
- 隠れたユースケース
- 依存関係逆転の法則 (Dependency Inversion Principle:DIP)がない
- メンテナンス性が低い(ビジネスドメインの変更コストが高い)

## 総括

どのアーキテクチャスタイルを使用するかの確証がまだ得られていない場合には、レイヤードアーキテクチャーがほとんどのアプリケーションにとっての最適な出発点になる。再利用を最小限に抑え、オブジェクト階層をかなり浅くして適度なモジュール性を維持することで、後に別のアーキテクチャスタイルに移行することが容易となる。
