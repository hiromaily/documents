# イベント駆動型アーキテクチャ (EDA)

イベント駆動アーキテクチャは、高度にスケーラブルで高パフォーマンスなアプリケーションを実現するために用いられる分散非同期型のアーキテクチャ。小規模から大規模まで様々な規模のアプリケーションに適応可能。
イベント駆動型アーキテクチャとは、アプリケーション設計用のソフトウェア・アーキテクチャモデル。イベント駆動型のシステムでは、分離されたサービス間でイベントのキャプチャ、通信、処理を行う。つまり、システムは非同期でありながら情報を共有し、タスクを実行することができる。
イベント駆動型アーキテクチャでは結合が最小限になるので、先進的な分散アプリケーション・アーキテクチャに適した選択肢となる。

## ベースモデル

非同期的にイベントを受信して処理する分散されたイベント処理コンポーネントで構成される。ほとんどのアプリケーションは`イベントベースモデル`ではなく、`リクエストベースモデル`と呼ばれるモデルを採用している。
`イベントベースモデル`では、特定の状況に反応し、そのイベントに基づいてアクションを実施する。

## 処理の流れ

イベントは`イベント プロデューサー`によって生成され、`イベント ルーター（またはブローカー）` によって排出され、`フィルタ`される。さらに、適切な`イベント コンシューマー（またはシンク）` にファンアウトされる。イベントは、1 つ以上のトリガーによって定義されたサブスクライバーに転送される。イベントは非同期に処理される。

## 機能の仕組み

イベント駆動型アーキテクチャは、イベントプロデューサー (パブリッシャー) とイベントコンシューマー (サブスクライバー) で構成されている。イベントプロデューサーはイベントを検出または感知し、イベントをメッセージとして表現する。デカップリングにより、イベントのコンシューマーやイベントの結果を知ることはない。

検出されたイベントは、イベントプロデューサーからイベントチャネルを通じてイベントコンシューマーに送信され、イベント処理プラットフォームで非同期的に処理される。イベントが発生したときには、その情報がイベントコンシューマーに伝わる必要がある。コンシューマーはイベントを処理することもあれば、ただ影響を受けるだけの場合もある。

イベント処理プラットフォームはイベントに対して適切な対応を実行し、アクティビティをダウンストリームの適切なコンシューマーに送信する。このダウンストリーム・アクティビティの出力が、イベントの結果となる。

`Apache Kafka` はイベント処理によく使われる分散データ・ストリーミング・プラットフォームで、イベントストリームのパブリッシュ、サブスクライブ、保存、処理をリアルタイムで処理できる。Apache Kafka は、高スループットとスケーラビリティが欠かせないさまざまなユースケースに対応し、特定のアプリケーションでのデータ共有に対してポイントツーポイントの統合の必要性を最小化するため、レイテンシーがミリ秒単位にまで短縮される。

## イベント駆動型アーキテクチャ・モデル

### Pub/Sub モデル

イベントストリームへのサブスクリプションをベースにした、メッセージング・インフラストラクチャ。このモデルでは、イベントが発生したりパブリッシュされたりすると、通知を受ける必要があるサブスクライバーに送信される。

### イベント・ストリーミング・モデル

イベント・ストリーミング・モデルでは、イベントはログに書き込まれる。イベントコンシューマーはイベントストリームにサブスクライブしないが、ストリームの任意の部分から読み取りを行い、いつでもストリームに接続することができる。

イベントストリーミングには、次のようないくつかの種類がある。

- イベントストリーム処理は、Apache Kafka のようなデータ・ストリーミング・プラットフォームを使用して、イベントを取り込み、イベントストリームを処理または変換する。
- シンプルなイベント処理では、イベントによって、即座にイベントコンシューマーでアクションがトリガーされる。

複雑なイベント処理では、パターンを検出するために、イベントコンシューマーが一連のイベントを処理する必要がある。イベントストリーミング処理は、イベントストリームから意味のあるパターンを検出するのに使用できる。

## イベントの特性

- 発生したことを記録する
- 変更や削除ができない不変のファクトをキャプチャする
- これは、サービスが使用時にロジックを適用するかどうかにかかわらず発生する
- 無期限かつ広範囲に維持できる。必要に応じて何度でも使用できる。

## イベント ドリブン アーキテクチャの利点

### 疎結合とデベロッパーのアジリティの向上

イベント プロデューサーはイベント コンシューマーと論理的に分離されている。イベントの生成と使用が分離されるため、サービスは相互運用できるが、スケーリング、更新、デプロイを相互に独立して行うこともできる。
疎結合によって依存関係が減少し、さまざまな言語とフレームワークでサービスを実装できる。イベント プロデューサーとレシーバは、それぞれのサービスでロジックを変更しなくても追加または削除できる。イベントをポーリング、フィルタ、転送するためにカスタムコードを作成する必要はない。

### 非同期のイベントと復元性

イベント ドリブン システムでは、イベントは非同期的に生成される。レスポンスを待たずに発行することも可能。コンポーネントが疎結合のため、1 つのサービスが失敗しても他のサービスに影響はない。必要であれば、受信側のサービスが障害点から再開できるようにイベントを記録できる。また、過去のイベントを再生することもできる。

### push ベースのメッセージング、リアルタイム イベント ストリーム、コスト削減

イベント ドリブン システムでは、push ベースのメッセージングを実現できる。クライアントは、リモート サービスを継続的にポーリングしなくても、状態変化の更新を受信できる。これらの push メッセージは、データの即時処理と変換、リアルタイム分析に使用できる。また、ポーリングが少ないため、ネットワーク I/O が減少し、コストを抑えることができる。

## 書籍

- [ソフトウェアアーキテクチャの基礎](https://www.oreilly.co.jp//books/9784873119823/)

## References

- [AWS: イベント駆動型アーキテクチャ (EDA) とは](https://aws.amazon.com/jp/what-is/eda/)
- [GCP: イベント ドリブン アーキテクチャ](https://cloud.google.com/eventarc/docs/event-driven-architectures?hl=ja)
- [RedHat: イベント駆動型アーキテクチャとは](https://www.redhat.com/ja/topics/integration/what-is-event-driven-architecture)
- [IBM: イベント駆動型アーキテクチャーとは](https://www.ibm.com/jp-ja/topics/event-driven-architecture)
- [イベント駆動アーキテクチャ ブローカータイプ /メディエータータイプ](https://minegishirei.hatenablog.com/entry/2023/01/28/175459)
