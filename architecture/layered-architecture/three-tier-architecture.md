# 三層アーキテクチャ / Three-Tier Architecture

**「レイヤードアーキテクチャ」（Layered Architecture）** または **「三層アーキテクチャ」（Three-Tier Architecture）** と呼ばれるもので、このアーキテクチャは、ソフトウェア開発において、アプリケーションを複数の層に分割することで、モジュール化と責務の分離を図る設計パターンの一つ。

## 主なレイヤーの構成

レイヤードアーキテクチャでは一般的に以下の層に分割される：

1. **プレゼンテーション層（Presentation Layer）**:

   - ユーザーインターフェースを担当します。Web アプリケーションでは、UI 関連のコード（HTML, CSS, JavaScript）がこの層に含まれる。
   - HTTP リクエストを受け取り、サービス層に処理を渡す責務も持ちます。

2. **ビジネスロジック層（Business Logic Layer）**:

   - アプリケーションのビジネスロジックを担当します。サービス層とも呼ばれる。
   - プレゼンテーション層からのリクエストを受けて、ビジネスロジックを実行し、データアクセス層に依頼を出します。

3. **データアクセス層（Data Access Layer）**:
   - データベースや他の永続化ストアへのアクセスを担当します。リポジトリ層とも呼ばれます。
   - ビジネスロジック層からのリクエストを受けて、データの取得、保存、更新、削除を行います。

### レイヤードアーキテクチャの利点

1. **モジュール化**:

   - 各層が独立しているため、特定の層だけを改修・拡張することが容易です。これにより、アプリケーションのメンテナンスが行いやすくなります。

2. **責務の分離**:

   - 各層が特定の目的に専念することで、コードが整理され、役割が明確になります。これにより、開発者がコードを理解しやすくなります。

3. **再利用性の向上**:

   - ビジネスロジック層やデータアクセス層のコンポーネントは、他のプレゼンテーション層やアプリケーションでも再利用が可能です。

4. **テストの容易さ**:
   - 各層が明確に分離されているため、ユニットテストやインテグレーションテストが容易です。特に、モックやスタブを利用しやすいという利点があります。

### 実際の構造

今回の構成を具体的に整理すると以下のようなレイヤーになります：

1. **プレゼンテーション層**:

   - `index.ts` 内のルートハンドラ部分がこれに該当します。Hono フレームワークを使って HTTP リクエストを受け取り、ビジネスロジック層に処理を渡しています。

2. **ビジネスロジック層**:

   - `services` ディレクトリ内の `todoService.ts` がこれに該当します。この層がビジネスロジック（TODO の作成、取得、更新、削除）を実行します。

3. **データアクセス層**:
   - `repositories` ディレクトリ内の各リポジトリクラス (`PostgresTodoRepository`, `MockTodoRepository`) がこれに該当します。データベースとのやり取り（永続化操作）を担当します。

### 依存性注入（DI）

また、依存性注入（DI, Dependency Injection）コンテナを導入することで、各層間の依存関係を外部から注入する設計にしました。DI を使用することで、依存関係の管理が容易になり、モックの差し替えが容易になるため、テストもしやすくなります。

まとめると、このアーキテクチャは標準的なレイヤードアーキテクチャであり、ビジネスロジックの管理、データアクセスの分離、依存関係の管理など、アプリケーションの開発を効率よく行うための手法を提供します。
