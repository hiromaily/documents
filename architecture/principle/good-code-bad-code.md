# Good Code, Bad Code 持続可能な開発のためのソフトウェアエンジニア的思想

## Part 1. 理論編

### Chapter 1. コードの品質

- 高品質なコード
  - 信頼度が高く、メンテナンスしやすく、バグが少ない
- 低品質なコード
  - 信頼度が低く、メンテナンスしにくく、バグだらけ

![code quality](../../images/goodcode-badcode/quality-of-code.png "code quality")

#### 高品質なコードが大事な理由

- 高品質なコードを書くことは、最初は開発の速度を落とすように見えるが、多くの場合、中長期的には開発の速度を上げることに繋がる

#### 高品質なコードが満たすべき４つのゴール

- 正しく動くこと
  - 要件を満たし、バグがない、パフォーマンスやセキュリティーについても同様
- 正しく動作し続けること
  - 長期的に動作し続けること
  - コードは機能追加や仕様変更などによって修正が加えられることになる
  - コードは他のコードに依存しているため、外部の修正によって壊れないことが重要
- 要件の変更に対応しやすいこと
  - コードを将来の変更に対応しやすくすることが重要
- 車輪の再発明をしないこと
  - 既存のコードを使うことのメリットは、
    - 時間と労力の節約
    - バグが減る
    - 既存の専門技術を使える
    - コードが理解しやすくなる

#### 高品質なコードであることを担保するための 6 つの上位の戦略

- コードを読みやすくする
- 想定外の事態をなくす
- 誤用しにくいコードを書く
- コードをモジュール化する
  - モジュール性とは物やシステムが交換可能なより小さいコンポーネントにまとめられることを指す
  - 機能を管理しやすい単位に分け、その単位間で相互作用する方法を明確に定義し、ドキュメント化する
- コードを再利用、汎用化しやすくする
  - `再利用性`とは、特定のあるものが複数のシナリオに出てくる同じ問題の解決に利用できること
  - `汎用性`とは、微妙に異なるものの、概念的には似ている複数の問題の解決に利用できること
  - モジュール化されたコードは、再利用、汎用化しやすくなる傾向がある
- テストしやすいコードを書き、適切にテストする
  - どれだけ test しやすいか、testability が重要になる
  - コーディングの段階でテストのことを考慮すること

### Chapter 2. 抽象化レイヤー

- どのようにコードを構造化するかは、コード品質における最も基本的な側面となる
- うまく構造化できれば、きれいな抽象化レイヤーにつながる
- 抽象化レイヤーを反映するようにコードを構造化することが、コードの読みやすさ、再利用性、汎用化のしやすさと Testability を大幅に改善する

#### 問題をきれいな抽象化レイヤーで小さな問題に切り分ける

- これにより個々のコードがそれほど複雑に見えることはない
- これによって複雑さを制御する

#### 抽象化レイヤーがいくつかのコード品質の柱を達成するのに、どのように役立つか

- `高品質なコードであることを担保するための 6 つの上位の戦略`のうち、4 つを達成することができる
  - 読みやすさ
  - モジュール性
  - 再利用性と汎用化
  - Testability

#### コードのレイヤー、API と実装の詳細

- コードを書くときに考えるべき 2 つの側面
  - 私達のコードの呼び出し元からみえるもの
  - 私達のコードを使う呼び出し元からはみえないもの。実装の詳細
- プログラミング言語のコードをさまざまな単位に分割するための構成概念
  - 関数
  - クラス
  - インターフェイス
  - パッケージ、名前空間、モジュール

##### 関数

- 単一のタスクのみを扱う
- 関数を小さくして焦点を絞ることは、コードの読みやすさと再利用性を担保する方法の１つ

##### クラス

- 行数。300 行を超えないようにする。多くの概念を含みすぎている場合は分割する。
- `凝縮`
  - 凝縮とは、クラス内のモノがどれだけ適切なクラスに所属しているかを評価するもので、凝集度の高いクラスがよいとされている
  - どれが何に凝集しているかを分類する方法は以下の通り
    - 逐次的凝集
      - 1 つの出力が他の入力に必要な場合、逐次的凝集が発生する
    - 機能的凝集
      - 一連のモノがすべて 1 つのタスクのために動く場合、機能的凝集が発生する
- `関心の分離`
  - `システムが個別に対処している問題ごとに、独立したコンポーネントとして分離すべき`という考え方の設計原則
- 凝集と関心の分離の考え方においては、関連するものをどのように１つにまとめれば役に立つかの基準を決定することが必要
- コードのレイヤー、クラスの作成に関するコード品質の 4 つの柱
  - コードを読みやすくする
    - 1 つのクラスにさまざまな概念を取り込むほど、コードは読みづらくなる
  - コードをモジュール化する
    - クラスやインターフェイスを使うことは、コードをモジュール化するための良い方法
    - 必要に応じて異なる実装と交換することも可能
  - コードの再利用性を高め、汎用化しやすくする
  - テストしやすいコードを書き、適切にテストする
- 凝集性の捉え方は主観により異なり、意見が分かれるケースもある。クラスをどのように分割すべきかを適切に判断するために`コード品質の柱`と照らし合わせる
  - e.g. コードが読みやすくない
  - e.g. コードがそれほどモジュール化されていない
  - e.g. コードの再利用性が低い
- コードを改善する方法
  - それぞれの小さな問題への解決策を別のクラスに分割する

##### インターフェイス

#### 関数、クラス、インターフェイスを使って、コードを明確な抽象化レイヤーに分割する方法

### Chapter 3. コードへの契約

### Chapter 4. エラー

## Part 2. 実践編

### Chapter 5. コードを読みやすくする

### Chapter 6. 想定外の事態をなくす

### Chapter 7. 誤用しにくいコードを書く

### Chapter 8. コードをモジュール化する

### Chapter 9. コードを再利用、汎用化しやすくする

## Part 3. UnitTest 編

### Chapter 10. UnitTest の原則

### Chapter 11. UnitTest の実践

## その他

### null 安全 (void 安全)

- `null`は値を取得できない場合などに、使われる
- 変数や関数の返す値が`null`である可能性を示し最初にその値を null か否かをチェックしなければ、利用できないようにコンパイラーが強制するというもの
- null 安全をサポートしていない言語を使う場合は、代替えとして`optional型`を利用する
