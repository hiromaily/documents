# [Supabase Auth](https://supabase.com/docs/guides/auth)

## 概要

Supabase Authを使えば、アプリに認証と認可を簡単に実装できる。 クライアントSDKとAPIエンドポイントを提供し、ユーザの作成と管理を支援する。
ユーザーは、パスワード、マジックリンク、ワンタイムパスワード (OTP)、ソーシャルログイン、シングルサインオン (SSO) など、多くの一般的な認証方法を使用できる。

Supabase Authは認証にJSON Web Tokens (JWT)を使用する。 AuthはSupabaseのデータベース機能と統合されており、Row Level Security (RLS)を簡単に認証に使用することができる。

### Supabaseのエコシステム

Supabase Authはスタンドアローンで使用することもできるが、Supabaseエコシステムと統合することもできる。

AuthはプロジェクトのPostgresデータベースを使用し、ユーザデータとその他のAuth情報を特別なスキーマに格納する。 このデータを、トリガーや外部キー参照を使って独自のテーブルに接続することができる。
Authはまた、データベースが自動的に生成するREST APIへのアクセス制御も可能にする。 Supabase SDKを使用する場合、データリクエストは自動的にユーザーのAuth Tokenと共に送信される。 Auth Tokenは、RLSポリシーとともに使用される場合、行ごとのレベルでデータベースアクセスをスコープする。

## アーキテクチャ

Supabase Authには大きく分けて4つのレイヤーがある

1. **クライアントレイヤー**: これは、SupabaseクライアントSDKの1つ、もしくは選んだHTTPクライアントを使用して手動でHTTPリクエストを行うことができる。
2. **Kong APIゲートウェイ**: これはすべてのSupabase製品で共有されている
3. **認証サービス (旧称 GoTrue)**
4. **Postgresデータベース**: これはすべてのSupabase製品で共有されている

### 1. クライアントレイヤー

クライアント・レイヤーはアプリ内で実行されるもので、これは以下を含む多くの場所で実行される可能性がある

- フロントエンド・ブラウザのコード
- バックエンドサーバーコード
- ネイティブ・アプリケーション

クライアントレイヤーは、サインインやユーザー管理に使用する機能を提供するため、SupabaseクライアントSDKを使用することができる

- Supabase AuthバックエンドへのHTTPコールの設定と認証
- アプリのストレージ媒体における認証トークンの永続化、更新、削除
- 他のSupabase製品との統合

しかし、このレイヤーのコアはHTTPコールの実行を管理することであり、独自のクライアントレイヤーを作成することも可能

### Authサービス

Auth serviceはSupabaseによって書かれ、保守されているAuth APIサーバー。 元々はNetlifyによって作られたGoTrueプロジェクトのFork。
新しい Supabase プロジェクトをデプロイすると、このサーバーのインスタンスがデータベースと一緒にデプロイされ、必要な Auth スキーマがデータベースに注入される。

Authサービスは以下を行う

- JWTの検証、発行、更新
- アプリとデータベース内の認証情報の仲介を行う
- ソーシャルログインとSSOのための外部プロバイダーとの通信

Supabase Authは、Postgresデータベースのauth スキーマを使用し、Userテーブルやその他の情報を保存する。 セキュリティのため、このスキーマは自動生成 API では公開されない。データベーストリガーと外部キーを使用して、Auth情報を独自のオブジェクトに接続することができる。
