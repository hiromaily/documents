# Event Loop

Event Loop（イベントループ）はJavaScriptの動作の仕組みの一部で、特に非同期処理の管理において非常に重要。
イベントループはJavaScriptの非同期性を管理するための重要なメカニズムであり、一連の同期的なタスクを処理しながら、非同期的なイベントやコールバックを適切なタイミングで実行する役割を果たしている。これにより、シングルスレッドでありながら効率的な非同期処理が可能になる。

## JavaScriptの実行環境とイベントループ

JavaScriptはシングルスレッドで動作する言語であり、一度に一つの命令しか実行できない。これに対して、イベントループは非同期処理をうまく管理し、スムーズな動作を可能にする。

## イベントループの主な構成要素

1. **Call Stack（コールスタック）**:
    - 同期的なタスク（関数呼び出し、評価など）が積み上げられ、実行される場所です。スタックに積み上げた順に処理を行い、呼び出しが完了するまで次の処理に進まない。

2. **Heap（ヒープ）**:
    - オブジェクトが格納される大きなメモリ領域。JavaScriptのオブジェクトや変数のデータがここに格納される。

3. **Queue（キュー）**:
    - 非同期的な処理（例えば、コールバックやイベントハンドラなど）が待機する場所。タスクキューとも呼ばれ、FIFO（First In, First Out）方式で処理される。

## イベントループの動き

イベントループは以下のように動作する：

1. **コールスタックが空になるまで実行する**：
    - 同期的なコードは即時にコールスタックに積まれ、順に処理される。例えば、`console.log('Hello!')` があれば、これがコールスタックに積まれ、即座に処理される。

2. **タスクキューをチェックする**：
    - コールスタックが空になると、イベントループはタスクキューをチェックする。キューに非同期的なコールバック（例えば、タイマーの終了やI/O操作の完了）があれば、それをコールスタックに積み上げる。

3. **次のタスクを実行**：
    - タスクキューからコールスタックに積まれた非同期処理が実行される。この過程を繰り返しながら、スムーズな非同期処理が実現される。

## 非同期処理の例

```js
console.log('Start');

setTimeout(() => {
    console.log('Timeout');
}, 1000);

console.log('End');
```

出力

```sh
Start
End
Timeout
```

- `console.log('Start')` がまずコールスタックに積まれ、即座に実行される。
- 次に `setTimeout` が呼ばれるが、この処理自体は非同期で、コールバック関数が後から実行される。なので、この時点でタイマーが動作を始める。
- `console.log('End')` がコールスタックに積まれ、即座に実行される。
- 1秒経過後、`setTimeout` のコールバックがTasks Queueに追加され、イベントループによってコールスタックに積まれ、最終的に `Timeout` が出力される。

## References

- [Event Loop in 2 Minutes](https://dev.to/bhataasim/event-loop-in-2-minutes-5895)
